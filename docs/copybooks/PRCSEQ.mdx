---
title: "PRCSEQ"
description: "Process Sequence Definitions - defines batch process sequencing, dependencies, scheduling, and recovery information"
---

## Overview

PRCSEQ is a copybook that defines the data structures for batch process sequencing and scheduling. It provides a comprehensive framework for managing the order, timing, dependencies, and recovery options for batch jobs in the Portfolio Management System.

The copybook contains two main structures:
1. **PROCESS-SEQUENCE-RECORD**: A detailed record layout for defining individual processes, their dependencies, scheduling rules, and recovery procedures
2. **STANDARD-SEQUENCES**: Predefined process sequence groups for common batch workflows (start-of-day, main processing, end-of-day)

This copybook is central to the batch orchestration subsystem, enabling:
- **Process ordering**: Defining the sequence in which jobs should run
- **Dependency management**: Specifying which jobs must complete before others can start
- **Schedule control**: Configuring when jobs run (daily, weekly, monthly, specific days)
- **Recovery handling**: Defining how to recover from job failures

## Data Structures

### PROCESS-SEQUENCE-RECORD

The primary record structure for process definitions, typically stored in an indexed VSAM file.

#### Key Fields (PSR-KEY)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PSR-KEY | Group | Composite primary key (10 bytes) |
| 10 | PSR-PROCESS-ID | X(8) | Unique process identifier |
| 10 | PSR-VERSION | 9(2) | Version number for the definition |

#### Process Data (PSR-DATA)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PSR-DATA | Group | Process definition data |
| 10 | PSR-DESCRIPTION | X(30) | Human-readable description |
| 10 | PSR-TYPE | X(3) | Process type code |
| 88 | PSR-TYPE-INIT | 'INI' | Initialization process |
| 88 | PSR-TYPE-PROC | 'PRC' | Processing/main process |
| 88 | PSR-TYPE-RPT | 'RPT' | Reporting process |
| 88 | PSR-TYPE-TERM | 'TRM' | Termination process |

#### Timing Information (PSR-TIMING)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | PSR-TIMING | Group | Timing controls |
| 15 | PSR-FREQ | X(1) | Execution frequency |
| 88 | PSR-DAILY | 'D' | Run daily |
| 88 | PSR-WEEKLY | 'W' | Run weekly |
| 88 | PSR-MONTHLY | 'M' | Run monthly |
| 15 | PSR-START-TIME | 9(4) | Earliest start time (HHMM) |
| 15 | PSR-MAX-TIME | 9(4) | Maximum run time in minutes |

#### Dependencies (PSR-DEPENDENCIES)

| Level | Name | Picture | Occurs | Description |
|-------|------|---------|--------|-------------|
| 10 | PSR-DEPENDENCIES | Group | | Dependency definitions |
| 15 | PSR-DEP-COUNT | 9(2) COMP | | Number of active dependencies |
| 15 | PSR-DEP-ENTRY | Group | 10 | Dependency entry (repeating) |
| 20 | PSR-DEP-ID | X(8) | | Process ID of prerequisite |
| 20 | PSR-DEP-TYPE | X(1) | | Dependency type |
| 88 | PSR-DEP-HARD | 'H' | | Hard dependency - must complete |
| 88 | PSR-DEP-SOFT | 'S' | | Soft dependency - preferred |
| 20 | PSR-DEP-RC | S9(4) COMP | | Maximum acceptable return code |

#### Control Information (PSR-CONTROL)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | PSR-CONTROL | Group | Execution control |
| 15 | PSR-PROGRAM | X(8) | Program name to execute |
| 15 | PSR-PARM | X(50) | Parameter string for program |
| 15 | PSR-MAX-RC | S9(4) COMP | Maximum acceptable return code |
| 15 | PSR-RESTART | X(1) | Restart capability flag |
| 88 | PSR-RESTARTABLE | 'Y' | Process can be restarted |
| 88 | PSR-NO-RESTART | 'N' | Process cannot be restarted |

#### Schedule Information (PSR-SCHEDULE)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PSR-SCHEDULE | Group | Scheduling rules |
| 10 | PSR-ACTIVE-DAYS | X(7) | Day-of-week flags (Sun-Sat) |
| 88 | PSR-WEEKDAY | 'YYYYYNN' | Monday through Friday |
| 88 | PSR-WEEKEND | 'NNNNNYY' | Saturday and Sunday |
| 88 | PSR-ALL-DAYS | 'YYYYYYY' | Every day |
| 10 | PSR-MONTH-END | X(1) | Month-end processing flag |
| 88 | PSR-LAST-DAY | 'Y' | Run on last day of month |
| 10 | PSR-HOLIDAY-RUN | X(1) | Holiday handling |
| 88 | PSR-SKIP-HOL | 'N' | Skip on holidays |
| 88 | PSR-RUN-HOL | 'Y' | Run on holidays |

#### Recovery Information (PSR-RECOVERY)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PSR-RECOVERY | Group | Recovery procedures |
| 10 | PSR-RECOVERY-PGM | X(8) | Recovery program name |
| 10 | PSR-RECOVERY-PARM | X(50) | Recovery program parameters |
| 10 | PSR-ERROR-LIMIT | 9(4) COMP | Max errors before termination |

#### Audit Trail (PSR-AUDIT)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PSR-AUDIT | Group | Audit information |
| 10 | PSR-CREATE-DATE | X(10) | Creation date (YYYY-MM-DD) |
| 10 | PSR-CREATE-USER | X(8) | Creating user ID |
| 10 | PSR-UPDATE-DATE | X(10) | Last update date |
| 10 | PSR-UPDATE-USER | X(8) | Last updating user ID |

#### Reserved Space

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PSR-FILLER | X(50) | Reserved for future use |

### STANDARD-SEQUENCES

Predefined constants for common batch processing workflows:

#### Start-of-Day Sequence (SEQ-START-OF-DAY)

| Position | Value | Description |
|----------|-------|-------------|
| 1-8 | 'INITDAY ' | Initialize day processing |
| 9-16 | 'CKPCLR  ' | Clear checkpoints |
| 17-24 | 'DATEVAL ' | Validate processing date |

#### Main Processing Sequence (SEQ-MAIN-PROCESS)

| Position | Value | Description |
|----------|-------|-------------|
| 1-8 | 'TRNVAL00' | Transaction validation |
| 9-16 | 'POSUPD00' | Position updates |
| 17-24 | 'HISTLD00' | History loading |

#### End-of-Day Sequence (SEQ-END-OF-DAY)

| Position | Value | Description |
|----------|-------|-------------|
| 1-8 | 'RPTGEN00' | Report generation |
| 9-16 | 'BCKLOD00' | Backup loading |
| 17-24 | 'ENDDAY  ' | End day processing |

## Record Layout Diagram

```
PROCESS-SEQUENCE-RECORD (Total: ~350 bytes)
├── PSR-KEY (10 bytes)
│   ├── PSR-PROCESS-ID    [8]
│   └── PSR-VERSION       [2]
├── PSR-DATA
│   ├── PSR-DESCRIPTION   [30]
│   ├── PSR-TYPE          [3]
│   ├── PSR-TIMING
│   │   ├── PSR-FREQ      [1]
│   │   ├── PSR-START-TIME[4]
│   │   └── PSR-MAX-TIME  [4]
│   ├── PSR-DEPENDENCIES
│   │   ├── PSR-DEP-COUNT [2 COMP]
│   │   └── PSR-DEP-ENTRY [10 occurrences × 11 bytes]
│   │       ├── PSR-DEP-ID    [8]
│   │       ├── PSR-DEP-TYPE  [1]
│   │       └── PSR-DEP-RC    [2 COMP]
│   └── PSR-CONTROL
│       ├── PSR-PROGRAM   [8]
│       ├── PSR-PARM      [50]
│       ├── PSR-MAX-RC    [2 COMP]
│       └── PSR-RESTART   [1]
├── PSR-SCHEDULE
│   ├── PSR-ACTIVE-DAYS   [7]
│   ├── PSR-MONTH-END     [1]
│   └── PSR-HOLIDAY-RUN   [1]
├── PSR-RECOVERY
│   ├── PSR-RECOVERY-PGM  [8]
│   ├── PSR-RECOVERY-PARM [50]
│   └── PSR-ERROR-LIMIT   [2 COMP]
├── PSR-AUDIT
│   ├── PSR-CREATE-DATE   [10]
│   ├── PSR-CREATE-USER   [8]
│   ├── PSR-UPDATE-DATE   [10]
│   └── PSR-UPDATE-USER   [8]
└── PSR-FILLER            [50]
```

## Usage

### File Definition

```cobol
FILE-CONTROL.
    SELECT PROCESS-SEQ-FILE
        ASSIGN TO PRCSEQ
        ORGANIZATION IS INDEXED
        ACCESS MODE IS DYNAMIC
        RECORD KEY IS PSR-KEY
        FILE STATUS IS WS-PSR-STATUS.

FILE SECTION.
FD  PROCESS-SEQ-FILE.
    COPY PRCSEQ.
```

### Working with Dependencies

```cobol
* Check all dependencies for a process
PERFORM VARYING WS-DEP-IX FROM 1 BY 1
        UNTIL WS-DEP-IX > PSR-DEP-COUNT
    
    IF PSR-DEP-HARD(WS-DEP-IX)
        * Hard dependency - must be complete
        PERFORM CHECK-HARD-DEPENDENCY
    ELSE
        * Soft dependency - preferred but optional
        PERFORM CHECK-SOFT-DEPENDENCY
    END-IF
END-PERFORM
```

### Checking Schedule

```cobol
* Check if process should run today
IF PSR-ACTIVE-DAYS(WS-DAY-OF-WEEK:1) = 'Y'
    IF PSR-SKIP-HOL AND WS-IS-HOLIDAY
        CONTINUE  *> Skip today
    ELSE
        PERFORM EXECUTE-PROCESS
    END-IF
END-IF
```

### Recovery Handling

```cobol
* Determine recovery action
IF PSR-RESTARTABLE
    PERFORM RESTART-PROCESS
ELSE
    IF WS-ERROR-COUNT > PSR-ERROR-LIMIT
        PERFORM TERMINATE-SEQUENCE
    ELSE
        PERFORM CALL-RECOVERY-PROGRAM
    END-IF
END-IF
```

## Programs Using This Copybook

| Program | Purpose | Usage |
|---------|---------|-------|
| PRCSEQ00 | Process Sequence Manager | Manages process sequencing, builds execution order, checks dependencies, tracks status |
| RCVPRC00 | Process Recovery Handler | Reads process definitions for recovery decisions, checks restartability flag |

## Related Copybooks

| Copybook | Relationship |
|----------|--------------|
| BCHCTL | Batch control records - runtime status of processes defined in PRCSEQ |
| BCHCON | Batch constants - status codes and return code values used with PRCSEQ |
| ERRHAND | Error handling - used when PRCSEQ operations fail |

## Design Notes

### Dependency Model

The copybook supports a flexible dependency model:
- **Hard dependencies** (`PSR-DEP-HARD`): The dependent process will not start until the prerequisite completes successfully
- **Soft dependencies** (`PSR-DEP-SOFT`): The scheduler prefers to wait but can proceed if necessary
- **Return code thresholds** (`PSR-DEP-RC`): Dependencies can specify acceptable return codes (e.g., proceed if RC ≤ 4)

### Day-of-Week Encoding

The `PSR-ACTIVE-DAYS` field uses a 7-character string where each position represents a day:
- Position 1: Sunday
- Position 2: Monday
- Position 3: Tuesday
- Position 4: Wednesday
- Position 5: Thursday
- Position 6: Friday
- Position 7: Saturday

'Y' indicates the process should run; 'N' indicates it should not.

### Version Control

The `PSR-VERSION` field allows multiple versions of a process definition to coexist, enabling:
- Testing new configurations alongside production
- Rollback to previous versions if issues occur
- Gradual migration of process definitions

### Standard Sequences

The `STANDARD-SEQUENCES` structure provides predefined job names for common batch workflows. Programs can reference these constants to ensure consistent naming across the system.
