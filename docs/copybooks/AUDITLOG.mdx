---
title: "AUDITLOG"
description: "Audit Trail Record Definitions - Defines the standard structure for recording system audit events"
---

## Overview

AUDITLOG is a copybook that defines the standard audit trail record structure used throughout the application for tracking system activities, user actions, and data changes. It provides a comprehensive layout for capturing who did what, when, and the before/after state of data modifications.

This copybook is essential for regulatory compliance, security monitoring, and forensic analysis. It supports multiple audit event types including transactions, user actions, and system events, with detailed tracking of the originating system, user, program, and terminal.

## Record Layout

```
+------------------------------------------------------------------+
| AUDIT-RECORD (318 bytes total)                                    |
+------------------------------------------------------------------+
| AUD-HEADER (58 bytes)                                             |
|   AUD-TIMESTAMP (26) | AUD-SYSTEM-ID (8) | AUD-USER-ID (8)       |
|   AUD-PROGRAM (8)    | AUD-TERMINAL (8)                          |
+------------------------------------------------------------------+
| AUD-TYPE (4) | AUD-ACTION (8) | AUD-STATUS (4)                   |
+------------------------------------------------------------------+
| AUD-KEY-INFO (18 bytes)                                           |
|   AUD-PORTFOLIO-ID (8) | AUD-ACCOUNT-NO (10)                     |
+------------------------------------------------------------------+
| AUD-BEFORE-IMAGE (100) | AUD-AFTER-IMAGE (100) | AUD-MESSAGE (100)|
+------------------------------------------------------------------+
```

## Data Structures

### AUDIT-RECORD (Level 01)

The main audit record containing all audit information.

### AUD-HEADER (Level 05)

Header section containing identification and context information:

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | AUD-TIMESTAMP | X(26) | ISO timestamp when event occurred (YYYY-MM-DD-HH.MM.SS.FFFFFF) |
| 10 | AUD-SYSTEM-ID | X(8) | System/subsystem identifier |
| 10 | AUD-USER-ID | X(8) | User who initiated the action |
| 10 | AUD-PROGRAM | X(8) | Program that generated the audit record |
| 10 | AUD-TERMINAL | X(8) | Terminal ID (for online transactions) |

### AUD-TYPE (Level 05)

Categorizes the type of audit event:

| Level | Name | Picture | 88-Level | Value | Description |
|-------|------|---------|----------|-------|-------------|
| 05 | AUD-TYPE | X(4) | - | - | Audit event type |
| - | - | - | AUD-TRANSACTION | 'TRAN' | Business transaction event |
| - | - | - | AUD-USER-ACTION | 'USER' | User-initiated action |
| - | - | - | AUD-SYSTEM-EVENT | 'SYST' | System-generated event |

### AUD-ACTION (Level 05)

Specifies the action being audited:

| Level | Name | Picture | 88-Level | Value | Description |
|-------|------|---------|----------|-------|-------------|
| 05 | AUD-ACTION | X(8) | - | - | Action performed |
| - | - | - | AUD-CREATE | 'CREATE  ' | Record/entity creation |
| - | - | - | AUD-UPDATE | 'UPDATE  ' | Record/entity modification |
| - | - | - | AUD-DELETE | 'DELETE  ' | Record/entity deletion |
| - | - | - | AUD-INQUIRE | 'INQUIRE ' | Read/query operation |
| - | - | - | AUD-LOGIN | 'LOGIN   ' | User login event |
| - | - | - | AUD-LOGOUT | 'LOGOUT  ' | User logout event |
| - | - | - | AUD-STARTUP | 'STARTUP ' | System/program startup |
| - | - | - | AUD-SHUTDOWN | 'SHUTDOWN' | System/program shutdown |

### AUD-STATUS (Level 05)

Indicates the outcome of the audited action:

| Level | Name | Picture | 88-Level | Value | Description |
|-------|------|---------|----------|-------|-------------|
| 05 | AUD-STATUS | X(4) | - | - | Action outcome |
| - | - | - | AUD-SUCCESS | 'SUCC' | Action completed successfully |
| - | - | - | AUD-FAILURE | 'FAIL' | Action failed |
| - | - | - | AUD-WARNING | 'WARN' | Action completed with warnings |

### AUD-KEY-INFO (Level 05)

Business key information for the audited entity:

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | AUD-PORTFOLIO-ID | X(8) | Portfolio identifier |
| 10 | AUD-ACCOUNT-NO | X(10) | Account number |

### Data Change Fields (Level 05)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | AUD-BEFORE-IMAGE | X(100) | Data state before the change |
| 05 | AUD-AFTER-IMAGE | X(100) | Data state after the change |
| 05 | AUD-MESSAGE | X(100) | Additional context or error message |

## Usage Examples

### Recording a Data Update

```cobol
MOVE FUNCTION CURRENT-DATE TO AUD-TIMESTAMP
MOVE 'PORTMGMT' TO AUD-SYSTEM-ID
MOVE WS-USER-ID TO AUD-USER-ID
MOVE 'PORTUPDT' TO AUD-PROGRAM
MOVE WS-TERMINAL TO AUD-TERMINAL

SET AUD-TRANSACTION TO TRUE
SET AUD-UPDATE TO TRUE
SET AUD-SUCCESS TO TRUE

MOVE PORT-ID TO AUD-PORTFOLIO-ID
MOVE PORT-ACCOUNT-NO TO AUD-ACCOUNT-NO

MOVE OLD-PORT-RECORD TO AUD-BEFORE-IMAGE
MOVE NEW-PORT-RECORD TO AUD-AFTER-IMAGE
MOVE 'Portfolio balance updated' TO AUD-MESSAGE

WRITE AUDIT-RECORD
```

### Recording a User Login

```cobol
MOVE FUNCTION CURRENT-DATE TO AUD-TIMESTAMP
MOVE 'SECURITY' TO AUD-SYSTEM-ID
MOVE LS-USER-ID TO AUD-USER-ID
MOVE 'SECMGR' TO AUD-PROGRAM
MOVE EIBTRMID TO AUD-TERMINAL

SET AUD-USER-ACTION TO TRUE
SET AUD-LOGIN TO TRUE

IF LOGIN-SUCCESSFUL
    SET AUD-SUCCESS TO TRUE
    MOVE 'User login successful' TO AUD-MESSAGE
ELSE
    SET AUD-FAILURE TO TRUE
    MOVE 'Login failed - invalid credentials' TO AUD-MESSAGE
END-IF

MOVE SPACES TO AUD-PORTFOLIO-ID
MOVE SPACES TO AUD-ACCOUNT-NO
MOVE SPACES TO AUD-BEFORE-IMAGE
MOVE SPACES TO AUD-AFTER-IMAGE

WRITE AUDIT-RECORD
```

### Recording a System Event

```cobol
MOVE FUNCTION CURRENT-DATE TO AUD-TIMESTAMP
MOVE 'BATCH' TO AUD-SYSTEM-ID
MOVE 'SYSTEM' TO AUD-USER-ID
MOVE 'BCHCTL00' TO AUD-PROGRAM
MOVE SPACES TO AUD-TERMINAL

SET AUD-SYSTEM-EVENT TO TRUE
SET AUD-STARTUP TO TRUE
SET AUD-SUCCESS TO TRUE

MOVE SPACES TO AUD-KEY-INFO
MOVE SPACES TO AUD-BEFORE-IMAGE
MOVE SPACES TO AUD-AFTER-IMAGE
MOVE 'Batch processing cycle started' TO AUD-MESSAGE

WRITE AUDIT-RECORD
```

## Programs Using This Copybook

| Program | Purpose |
|---------|---------|
| RPTAUD00 | Audit report generator - reads and reports on audit records |
| AUDPROC | Audit processing utility - manages audit record creation and storage |
| PORTTRAN | Portfolio transaction processor - creates audit records for portfolio changes |

## Related Copybooks

| Copybook | Relationship |
|----------|--------------|
| ERRHAND | Error handling - often used with AUDITLOG to record error events |
| RTNCODE | Return code management - status codes may trigger audit entries |
| TRNREC | Transaction record - transactions often generate audit records |

## Best Practices

### 1. Always Populate Required Fields

```cobol
* Minimum required fields for any audit record
MOVE FUNCTION CURRENT-DATE TO AUD-TIMESTAMP
MOVE program-id TO AUD-PROGRAM
MOVE user-id TO AUD-USER-ID
* Set AUD-TYPE, AUD-ACTION, and AUD-STATUS using 88-levels
```

### 2. Use 88-Level Conditions

```cobol
* Use SET for readable, self-documenting code
SET AUD-TRANSACTION TO TRUE
SET AUD-UPDATE TO TRUE
SET AUD-SUCCESS TO TRUE

* NOT this:
MOVE 'TRAN' TO AUD-TYPE
MOVE 'UPDATE  ' TO AUD-ACTION
MOVE 'SUCC' TO AUD-STATUS
```

### 3. Capture Before/After Images for Updates

```cobol
* For data changes, always capture both states
IF updating-record
    MOVE OLD-RECORD TO AUD-BEFORE-IMAGE
    MOVE NEW-RECORD TO AUD-AFTER-IMAGE
END-IF
```

### 4. Include Meaningful Messages

```cobol
* Provide context that helps with analysis
STRING 'Updated balance from ' OLD-BALANCE
       ' to ' NEW-BALANCE
       DELIMITED BY SIZE
       INTO AUD-MESSAGE
```

## Technical Notes

1. **Timestamp Format**: AUD-TIMESTAMP uses 26 characters to accommodate DB2 TIMESTAMP format (YYYY-MM-DD-HH.MM.SS.FFFFFF)

2. **88-Level Values**: Action values are padded to 8 characters with trailing spaces (e.g., 'CREATE  ') for consistent field sizing

3. **Image Fields**: The 100-byte before/after image fields may need to store compressed or key fields only for large records; consider using reference keys instead of full record images

4. **Terminal Field**: For batch programs, AUD-TERMINAL can be set to spaces or a batch identifier

5. **System ID**: Use consistent system identifiers across the application (e.g., 'PORTMGMT', 'SECURITY', 'BATCH') for filtering audit reports

6. **Key Information**: AUD-KEY-INFO is designed for portfolio/account keys; extend or redefine for other entity types as needed

## Compliance Considerations

This audit record structure supports:

- **SOX Compliance**: Tracks data changes with before/after images
- **PCI-DSS**: Records user access and authentication events
- **GDPR**: Documents data access and modifications for data subject requests
- **Internal Audit**: Provides complete trail for forensic analysis

Ensure audit records are:
- Written synchronously (not buffered) for critical events
- Protected from modification after creation
- Retained according to regulatory requirements
- Included in backup/recovery procedures
