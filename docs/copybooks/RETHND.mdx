---
title: "RETHND"
description: "Return Code Handling Definitions - structured return status, error details, and action control for subprograms"
---

## Overview

RETHND is a copybook that provides comprehensive return code handling definitions for subprogram communication. It defines a structured approach to passing return status, error details, and action directives between calling and called programs.

This copybook is designed for use with service-oriented programs where detailed error information needs to flow back to the caller. It complements the simpler ERRHAND copybook by providing:
- **Structured return status** with reason codes and module identification
- **Detailed error location** tracking (program, paragraph, routine)
- **Error classification** by type (validation, processing, database, file, security)
- **Action control** for determining how to proceed after errors
- **Standard error codes** for common error conditions

## Data Structures

### Return Handling (RETURN-HANDLING)

The main structure for return information passed via linkage section:

```
┌─────────────────────────────────────────────────────────────────┐
│                      RETURN-HANDLING                             │
├─────────────────────────────────────────────────────────────────┤
│ RETURN-STATUS                                                   │
│ ├── RETURN-CODE (S9(4) COMP)                                    │
│ ├── REASON-CODE (S9(4) COMP)                                    │
│ ├── MODULE-ID (X(8))                                            │
│ └── FUNCTION-ID (X(8))                                          │
├─────────────────────────────────────────────────────────────────┤
│ RETURN-DETAILS                                                  │
│ ├── ERROR-LOCATION                                              │
│ │   ├── PROGRAM-NAME (X(8))                                     │
│ │   ├── PARAGRAPH-NAME (X(8))                                   │
│ │   └── ERROR-ROUTINE (X(8))                                    │
│ ├── ERROR-INFO                                                  │
│ │   ├── ERROR-TYPE (X(1))                                       │
│ │   ├── ERROR-CODE (X(4))                                       │
│ │   └── ERROR-TEXT (X(80))                                      │
│ └── SYSTEM-INFO                                                 │
│     ├── SYSTEM-CODE (X(4))                                      │
│     └── SYSTEM-MSG (X(80))                                      │
├─────────────────────────────────────────────────────────────────┤
│ RETURN-ACTIONS                                                  │
│ ├── ACTION-FLAG (X(1))                                          │
│ ├── RETRY-COUNT (9(2) COMP)                                     │
│ └── MAX-RETRIES (9(2) COMP) = 3                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Return Status (RETURN-STATUS)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | RETURN-STATUS | - | Status information group |
| 10 | RETURN-CODE | S9(4) COMP | Primary return code |
| 10 | REASON-CODE | S9(4) COMP | Secondary reason code |
| 10 | MODULE-ID | X(8) | Module/program identifier |
| 10 | FUNCTION-ID | X(8) | Function being performed |

#### Return Code Values (RETURN-CODE)

| Value | 88-Level Name | Meaning |
|-------|---------------|---------|
| +0 | RC-SUCCESS | Successful completion |
| +4 | RC-WARNING | Warning - completed with issues |
| +8 | RC-ERROR | Error - operation failed |
| +12 | RC-SEVERE | Severe error - critical failure |
| +16 | RC-CRITICAL | Critical error - immediate abort |

### Return Details (RETURN-DETAILS)

#### Error Location

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | ERROR-LOCATION | - | Error location group |
| 15 | PROGRAM-NAME | X(8) | Program where error occurred |
| 15 | PARAGRAPH-NAME | X(8) | Paragraph where error occurred |
| 15 | ERROR-ROUTINE | X(8) | Error handling routine invoked |

#### Error Information

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | ERROR-INFO | - | Error information group |
| 15 | ERROR-TYPE | X(1) | Error type classification |
| 15 | ERROR-CODE | X(4) | Specific error code |
| 15 | ERROR-TEXT | X(80) | Error description text |

##### Error Type Values (ERROR-TYPE)

| Value | 88-Level Name | Meaning |
|-------|---------------|---------|
| `'V'` | ERR-VALIDATION | Validation error |
| `'P'` | ERR-PROCESSING | Processing/logic error |
| `'D'` | ERR-DATABASE | Database error |
| `'F'` | ERR-FILE | File I/O error |
| `'S'` | ERR-SECURITY | Security/authorization error |

#### System Information

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | SYSTEM-INFO | - | System-level information |
| 15 | SYSTEM-CODE | X(4) | System/subsystem error code |
| 15 | SYSTEM-MSG | X(80) | System error message |

### Return Actions (RETURN-ACTIONS)

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 05 | RETURN-ACTIONS | - | - | Action control group |
| 10 | ACTION-FLAG | X(1) | - | Recommended action |
| 10 | RETRY-COUNT | 9(2) COMP | - | Current retry attempt |
| 10 | MAX-RETRIES | 9(2) COMP | 3 | Maximum retry attempts |

#### Action Flag Values (ACTION-FLAG)

| Value | 88-Level Name | Meaning |
|-------|---------------|---------|
| `'C'` | ACTION-CONTINUE | Continue processing |
| `'A'` | ACTION-ABORT | Abort processing |
| `'R'` | ACTION-RETRY | Retry the operation |

### Standard Error Codes (STD-ERROR-CODES)

Pre-defined error codes for common error conditions:

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 01 | STD-ERROR-CODES | - | - | Standard error code constants |
| 05 | ERR-INVALID-DATA | X(4) | `'E001'` | Invalid data format/content |
| 05 | ERR-NOT-FOUND | X(4) | `'E002'` | Record/resource not found |
| 05 | ERR-DUPLICATE | X(4) | `'E003'` | Duplicate key/record |
| 05 | ERR-FILE-ERROR | X(4) | `'E004'` | File I/O error |
| 05 | ERR-DB-ERROR | X(4) | `'E005'` | Database error |
| 05 | ERR-SECURITY | X(4) | `'E006'` | Security violation |
| 05 | ERR-PROCESSING | X(4) | `'E007'` | Processing error |
| 05 | ERR-VALIDATION | X(4) | `'E008'` | Validation failure |
| 05 | ERR-VERSION | X(4) | `'E009'` | Version mismatch |
| 05 | ERR-TIMEOUT | X(4) | `'E010'` | Operation timeout |

## Usage Examples

### Setting Return Status (Called Program)

```cobol
WORKING-STORAGE SECTION.
    COPY RETHND.

LINKAGE SECTION.
01  LS-RETURN-STATUS.
    COPY RETHND REPLACING ==RETURN-HANDLING== BY ==LS-RETURN-HANDLING==.

PROCEDURE DIVISION USING LS-RETURN-STATUS.
    ...
    * Successful completion
    SET RC-SUCCESS TO TRUE
    MOVE ZEROS TO REASON-CODE
    MOVE 'CKPRST' TO MODULE-ID
    MOVE 'INIT' TO FUNCTION-ID
    SET ACTION-CONTINUE TO TRUE
    GOBACK
    ...
```

### Reporting an Error (Called Program)

```cobol
    * Report a validation error
    SET RC-ERROR TO TRUE
    MOVE 1001 TO REASON-CODE
    MOVE 'PORTMSTR' TO MODULE-ID
    MOVE 'VALIDATE' TO FUNCTION-ID
    
    MOVE 'PORTMSTR' TO PROGRAM-NAME
    MOVE '2100-VAL' TO PARAGRAPH-NAME
    MOVE '9000-ERR' TO ERROR-ROUTINE
    
    SET ERR-VALIDATION TO TRUE
    MOVE ERR-INVALID-DATA TO ERROR-CODE
    MOVE 'Invalid portfolio ID format' TO ERROR-TEXT
    
    INITIALIZE SYSTEM-INFO
    
    SET ACTION-ABORT TO TRUE
    GOBACK
```

### Checking Return Status (Calling Program)

```cobol
    CALL 'CKPRST' USING WS-CHECKPOINT-CONTROL
                        WS-RETURN-STATUS
    
    EVALUATE TRUE
        WHEN RC-SUCCESS
            CONTINUE
        WHEN RC-WARNING
            PERFORM LOG-WARNING
            CONTINUE
        WHEN RC-ERROR
            PERFORM HANDLE-ERROR
            IF ACTION-RETRY AND RETRY-COUNT < MAX-RETRIES
                ADD 1 TO RETRY-COUNT
                PERFORM RETRY-OPERATION
            ELSE
                PERFORM ABORT-PROCESSING
            END-IF
        WHEN RC-SEVERE OR RC-CRITICAL
            DISPLAY 'CRITICAL ERROR IN ' MODULE-ID
            DISPLAY 'FUNCTION: ' FUNCTION-ID
            DISPLAY 'ERROR: ' ERROR-TEXT
            PERFORM EMERGENCY-ABORT
    END-EVALUATE
```

### Implementing Retry Logic

```cobol
RETRY-OPERATION.
    IF RETRY-COUNT < MAX-RETRIES
        ADD 1 TO RETRY-COUNT
        DISPLAY 'Retry attempt ' RETRY-COUNT ' of ' MAX-RETRIES
        
        * Wait before retry (if needed)
        CALL 'ILBOABN0' USING WS-WAIT-SECONDS
        
        * Attempt operation again
        PERFORM CALL-SERVICE
    ELSE
        DISPLAY 'Max retries exceeded'
        SET ACTION-ABORT TO TRUE
        PERFORM HANDLE-FINAL-FAILURE
    END-IF.
```

### Logging Detailed Error Information

```cobol
LOG-ERROR-DETAILS.
    DISPLAY '=========================================='
    DISPLAY 'ERROR REPORT'
    DISPLAY '=========================================='
    DISPLAY 'Return Code:    ' RETURN-CODE
    DISPLAY 'Reason Code:    ' REASON-CODE
    DISPLAY 'Module:         ' MODULE-ID
    DISPLAY 'Function:       ' FUNCTION-ID
    DISPLAY '------------------------------------------'
    DISPLAY 'Program:        ' PROGRAM-NAME
    DISPLAY 'Paragraph:      ' PARAGRAPH-NAME
    DISPLAY 'Error Routine:  ' ERROR-ROUTINE
    DISPLAY '------------------------------------------'
    DISPLAY 'Error Type:     ' ERROR-TYPE
    DISPLAY 'Error Code:     ' ERROR-CODE
    DISPLAY 'Error Text:     ' ERROR-TEXT
    DISPLAY '------------------------------------------'
    DISPLAY 'System Code:    ' SYSTEM-CODE
    DISPLAY 'System Message: ' SYSTEM-MSG
    DISPLAY '------------------------------------------'
    DISPLAY 'Action:         ' ACTION-FLAG
    DISPLAY 'Retry Count:    ' RETRY-COUNT '/' MAX-RETRIES
    DISPLAY '=========================================='.
```

## Error Type Guidelines

| Type | Code | Use For | Examples |
|------|------|---------|----------|
| Validation | `'V'` | Input/data validation failures | Invalid format, missing required field, out of range |
| Processing | `'P'` | Business logic errors | Rule violation, calculation error, state mismatch |
| Database | `'D'` | DB2/database errors | SQL error, deadlock, connection failure |
| File | `'F'` | VSAM/file I/O errors | Open failure, read error, status code |
| Security | `'S'` | Authorization failures | Access denied, invalid credentials, expired token |

## Programs Using This Copybook

| Program | Purpose |
|---------|---------|
| CKPRST | Checkpoint/restart service module |

RETHND is designed primarily for the checkpoint/restart subsystem but can be adopted by any service-oriented program requiring detailed return status communication.

## Comparison with ERRHAND

| Aspect | RETHND | ERRHAND |
|--------|--------|---------|
| **Purpose** | Subprogram return status | Error logging/handling |
| **Usage** | Linkage section communication | Working storage logging |
| **Return codes** | With 88-levels (RC-SUCCESS, etc.) | Constants only (ERR-SUCCESS, etc.) |
| **Error location** | Program, paragraph, routine | Program only |
| **Action control** | Continue/Abort/Retry with counters | Not included |
| **System info** | Separate system code/message | Combined in message |
| **Reason codes** | Included | Not included |

## Technical Notes

### COBOL Constructs Used

- **88-Level Conditions**: Extensive use of condition names for readable status and type checking. Using `SET RC-ERROR TO TRUE` is clearer than `MOVE +8 TO RETURN-CODE`.

- **COMP Fields**: Binary fields used for return codes and counters for efficient comparison and arithmetic.

- **VALUE Clause**: MAX-RETRIES is initialized to 3, providing a sensible default that can be overridden.

- **Nested Groups**: Three-level nesting (RETURN-HANDLING → RETURN-DETAILS → ERROR-LOCATION) for logical organization.

### Record Size

| Section | Size (bytes) |
|---------|--------------|
| RETURN-STATUS | ~22 |
| RETURN-DETAILS | ~197 |
| RETURN-ACTIONS | ~6 |
| **RETURN-HANDLING Total** | ~225 |
| STD-ERROR-CODES | 40 |

### Linkage Section Usage

When using RETHND in the linkage section, the calling program should define a matching area:

```cobol
* Calling program
WORKING-STORAGE SECTION.
01  WS-RETURN-STATUS.
    COPY RETHND.

PROCEDURE DIVISION.
    CALL 'SUBPROG' USING ... WS-RETURN-STATUS
```

```cobol
* Called program
LINKAGE SECTION.
01  LS-RETURN-STATUS.
    COPY RETHND.

PROCEDURE DIVISION USING ... LS-RETURN-STATUS.
```

### Best Practices

1. **Always initialize**: Clear RETURN-HANDLING at the start of each call
2. **Set all relevant fields**: Don't leave location or error info blank on errors
3. **Use 88-levels**: Prefer `SET RC-ERROR TO TRUE` over literal moves
4. **Include context**: MODULE-ID and FUNCTION-ID help identify the source
5. **Populate SYSTEM-INFO**: Include system codes when available (SQLCODE, file status)
6. **Honor action flags**: Calling programs should respect ACTION-CONTINUE/ABORT/RETRY
7. **Track retries**: Increment RETRY-COUNT and check against MAX-RETRIES
