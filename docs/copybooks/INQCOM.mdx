---
title: "INQCOM"
description: "Online inquiry communication area copybook defining the interface structure for CICS inquiry transactions including function codes, account data, and response handling"
---

## Overview

INQCOM is a CICS communication area copybook that defines the standard interface for online inquiry transactions in the portfolio management system. It provides the data structure passed between CICS programs via COMMAREA, enabling consistent communication across the inquiry subsystem.

This copybook serves as the contract between:
- **INQONLN**: Main inquiry handler that receives user requests
- **INQPORT**: Portfolio inquiry processor
- **INQHIST**: Transaction history inquiry processor

The structure supports:
- **Function routing**: Directing requests to appropriate handlers
- **Data passing**: Account numbers and search criteria
- **Response handling**: Return codes and error messages
- **Session management**: Menu navigation and exit handling

## Data Structures

### Complete Record Layout (INQCOM-AREA)

| Level | Name | Picture | Bytes | Description |
|-------|------|---------|-------|-------------|
| 01 | INQCOM-AREA | - | 98 | Complete communication area |
| 05 | INQCOM-FUNCTION | X(4) | 4 | Function code |
| 05 | INQCOM-ACCOUNT-NO | X(10) | 10 | Account number for inquiry |
| 05 | INQCOM-RESPONSE-CODE | S9(8) COMP | 4 | Response/return code |
| 05 | INQCOM-ERROR-MSG | X(80) | 80 | Error message text |

### Function Codes (88-Level Conditions)

| Condition Name | Value | Description |
|----------------|-------|-------------|
| INQCOM-MENU | 'MENU' | Display main inquiry menu |
| INQCOM-PORTFOLIO | 'INQP' | Portfolio inquiry request |
| INQCOM-HISTORY | 'INQH' | Transaction history inquiry |
| INQCOM-EXIT | 'EXIT' | Terminate inquiry session |

## Field Specifications

### INQCOM-FUNCTION

- **Format**: 4 alphanumeric characters
- **Purpose**: Identifies the requested operation
- **Usage**: Set by the calling program or BMS map input
- **Validation**: Should match one of the 88-level conditions

| Code | Handler Program | Description |
|------|-----------------|-------------|
| `MENU` | INQONLN | Returns to main menu display |
| `INQP` | INQPORT | Routes to portfolio inquiry |
| `INQH` | INQHIST | Routes to history inquiry |
| `EXIT` | INQONLN | Terminates the session |

### INQCOM-ACCOUNT-NO

- **Format**: 10 alphanumeric characters
- **Purpose**: Identifies the account/portfolio to query
- **Usage**: Populated from screen input before calling inquiry programs
- **Example**: `1234567890`, `ACCT000001`

### INQCOM-RESPONSE-CODE

- **Format**: Signed 8-digit binary (COMP)
- **Purpose**: Returns status from called programs
- **Range**: -99999999 to +99999999
- **Storage**: 4 bytes

| Value | Meaning |
|-------|---------|
| 0 | Success |
| > 0 | Warning or informational |
| < 0 | Error condition |

Common response codes:

| Code | Description |
|------|-------------|
| 0 | Successful completion |
| 4 | Record not found |
| 8 | Invalid input |
| 12 | Security violation |
| 16 | System error |

### INQCOM-ERROR-MSG

- **Format**: 80 alphanumeric characters
- **Purpose**: Contains descriptive error message text
- **Usage**: Populated when INQCOM-RESPONSE-CODE is non-zero
- **Display**: Shown to user on error screens

## Usage Examples

### Main Handler Dispatching (INQONLN)

```cobol
WORKING-STORAGE SECTION.
01  WS-COMMAREA.
    COPY INQCOM.

LINKAGE SECTION.
01  DFHCOMMAREA.
    COPY INQCOM.

PROCEDURE DIVISION.
    EVALUATE TRUE
        WHEN INQCOM-MENU
            PERFORM P200-DISPLAY-MENU
        WHEN INQCOM-PORTFOLIO
            EXEC CICS LINK PROGRAM('INQPORT')
                 COMMAREA(WS-COMMAREA)
                 LENGTH(LENGTH OF WS-COMMAREA)
            END-EXEC
        WHEN INQCOM-HISTORY
            EXEC CICS LINK PROGRAM('INQHIST')
                 COMMAREA(WS-COMMAREA)
                 LENGTH(LENGTH OF WS-COMMAREA)
            END-EXEC
        WHEN INQCOM-EXIT
            SET SESSION-TERMINATED TO TRUE
    END-EVALUATE
    .
```

### Portfolio Inquiry Handler (INQPORT)

```cobol
WORKING-STORAGE SECTION.
    COPY INQCOM.
    COPY POSREC.

LINKAGE SECTION.
01  DFHCOMMAREA.
    COPY INQCOM.

PROCEDURE DIVISION.
* Validate account number
    IF INQCOM-ACCOUNT-NO = SPACES
        MOVE 8 TO INQCOM-RESPONSE-CODE
        MOVE 'Account number is required' 
          TO INQCOM-ERROR-MSG
        EXEC CICS RETURN END-EXEC
    END-IF
    
* Look up portfolio
    MOVE INQCOM-ACCOUNT-NO TO POS-PORTFOLIO-ID
    PERFORM 2000-READ-PORTFOLIO
    
    IF WS-PORTFOLIO-FOUND
        MOVE 0 TO INQCOM-RESPONSE-CODE
        MOVE SPACES TO INQCOM-ERROR-MSG
    ELSE
        MOVE 4 TO INQCOM-RESPONSE-CODE
        MOVE 'Portfolio not found' TO INQCOM-ERROR-MSG
    END-IF
    
    EXEC CICS RETURN END-EXEC
    .
```

### Setting Function Code from Map

```cobol
P100-PROCESS-MAP-INPUT.
    EXEC CICS RECEIVE MAP('INQMAP')
              MAPSET('INQSET')
              INTO(WS-MAP-DATA)
    END-EXEC
    
    EVALUATE WS-MAP-SELECTION
        WHEN '1'
            MOVE 'INQP' TO INQCOM-FUNCTION
        WHEN '2'
            MOVE 'INQH' TO INQCOM-FUNCTION
        WHEN 'X'
            MOVE 'EXIT' TO INQCOM-FUNCTION
        WHEN OTHER
            MOVE 'MENU' TO INQCOM-FUNCTION
    END-EVALUATE
    
    MOVE WS-MAP-ACCOUNT TO INQCOM-ACCOUNT-NO
    .
```

### Error Response Handling

```cobol
P300-CHECK-RESPONSE.
    IF INQCOM-RESPONSE-CODE NOT = 0
        MOVE INQCOM-ERROR-MSG TO WS-SCREEN-MESSAGE
        PERFORM P900-DISPLAY-ERROR
    ELSE
        PERFORM P400-DISPLAY-RESULTS
    END-IF
    .

P900-DISPLAY-ERROR.
    MOVE INQCOM-ERROR-MSG TO MAP-ERROR-MESSAGE
    MOVE -1 TO MAP-ACCOUNT-L
    
    EXEC CICS SEND MAP('INQMAP')
              MAPSET('INQSET')
              CURSOR
    END-EXEC
    .
```

### Initializing Communication Area

```cobol
P000-INITIALIZE-COMMAREA.
    INITIALIZE INQCOM-AREA
    MOVE 'MENU' TO INQCOM-FUNCTION
    MOVE SPACES TO INQCOM-ACCOUNT-NO
    MOVE 0 TO INQCOM-RESPONSE-CODE
    MOVE SPACES TO INQCOM-ERROR-MSG
    .
```

## Programs Using This Copybook

INQCOM is used by 3 programs in the online inquiry subsystem:

| Program | Role | Description |
|---------|------|-------------|
| INQONLN | Controller | Main inquiry handler - routes requests |
| INQPORT | Handler | Portfolio inquiry processor |
| INQHIST | Handler | Transaction history inquiry processor |

### Program Interaction Flow

```
┌─────────────────────────────────────────────────────────┐
│                        User                              │
│                          │                               │
│                          ▼                               │
│                    ┌──────────┐                          │
│                    │  INQONLN │  (Main Handler)          │
│                    └────┬─────┘                          │
│                         │                                │
│         ┌───────────────┼───────────────┐                │
│         │               │               │                │
│         ▼               ▼               ▼                │
│    ┌─────────┐    ┌──────────┐    ┌──────────┐          │
│    │ INQPORT │    │ INQHIST  │    │   EXIT   │          │
│    │(Portfolio)   │(History) │    │          │          │
│    └─────────┘    └──────────┘    └──────────┘          │
│                                                          │
│    All programs share INQCOM-AREA via COMMAREA           │
└─────────────────────────────────────────────────────────┘
```

## Related Copybooks

| Copybook | Relationship |
|----------|--------------|
| ERRHND | Online error handling - complements INQCOM for error management |
| POSREC | Position record - data retrieved by INQPORT |
| HISTREC | History record - data retrieved by INQHIST |

## Technical Notes

### CICS COMMAREA Usage

The INQCOM-AREA is designed for CICS COMMAREA passing:

```cobol
* Calling program
EXEC CICS LINK PROGRAM('INQPORT')
          COMMAREA(WS-COMMAREA)
          LENGTH(LENGTH OF WS-COMMAREA)
END-EXEC

* Called program receives via DFHCOMMAREA
LINKAGE SECTION.
01  DFHCOMMAREA.
    COPY INQCOM.

PROCEDURE DIVISION.
    IF EIBCALEN > 0
        MOVE DFHCOMMAREA TO WS-COMMAREA
    END-IF
```

### Storage Considerations

| Field | Storage | Notes |
|-------|---------|-------|
| INQCOM-FUNCTION | 4 bytes | Character |
| INQCOM-ACCOUNT-NO | 10 bytes | Character |
| INQCOM-RESPONSE-CODE | 4 bytes | Binary (COMP) |
| INQCOM-ERROR-MSG | 80 bytes | Character |
| **Total** | **98 bytes** | Compact for COMMAREA |

### Response Code Standards

Follow these conventions for consistency:

| Range | Category | Action |
|-------|----------|--------|
| 0 | Success | Display results |
| 1-7 | Warning | Display results with message |
| 8-15 | User Error | Display error, allow retry |
| 16+ | System Error | Display error, may need to exit |

### Pseudo-Conversational Considerations

In CICS pseudo-conversational programming:

1. **First Entry** (EIBCALEN = 0):
   - Initialize INQCOM-AREA
   - Set default function (MENU)
   - Display initial screen

2. **Subsequent Entries** (EIBCALEN > 0):
   - Restore from DFHCOMMAREA
   - Process based on INQCOM-FUNCTION
   - Update response fields
   - Return with updated COMMAREA

```cobol
PROCEDURE DIVISION.
    EVALUATE TRUE
        WHEN EIBCALEN = 0
            PERFORM P000-FIRST-TIME
        WHEN OTHER
            MOVE DFHCOMMAREA TO WS-COMMAREA
            PERFORM P100-PROCESS-REQUEST
    END-EVALUATE
    
    EXEC CICS RETURN TRANSID('INQ1')
              COMMAREA(WS-COMMAREA)
              LENGTH(LENGTH OF WS-COMMAREA)
    END-EXEC
    .
```

### Error Message Guidelines

When populating INQCOM-ERROR-MSG:

1. **Be specific**: "Account 1234567890 not found" vs "Not found"
2. **Be actionable**: "Enter a valid 10-digit account number"
3. **Avoid technical jargon**: "Unable to retrieve data" vs "VSAM status 23"
4. **Keep it brief**: Maximum 80 characters

### Extending the Structure

To add fields without breaking existing programs:

1. Add new fields at the end of INQCOM-AREA
2. Use EIBCALEN to detect old vs new callers
3. Initialize new fields to defaults for old callers

```cobol
01  INQCOM-AREA.
    05 INQCOM-FUNCTION         PIC X(4).
    05 INQCOM-ACCOUNT-NO       PIC X(10).
    05 INQCOM-RESPONSE-CODE    PIC S9(8) COMP.
    05 INQCOM-ERROR-MSG        PIC X(80).
*   New fields added below
    05 INQCOM-DATE-FROM        PIC X(10).
    05 INQCOM-DATE-TO          PIC X(10).
```
