---
title: "RPTAUD00"
description: "Batch audit report generator that produces comprehensive system audit and error summary reports"
---

## Overview

RPTAUD00 is a batch report program that generates comprehensive system audit reports. It reads from two indexed VSAM files—an audit trail log and an error log—and produces a formatted sequential report file containing security audit trails, process audit information, error summaries, and control verification data.

The program is designed to support system compliance and monitoring requirements by consolidating audit and error information into a single, readable report. This enables operations teams and auditors to review system activity, identify security events, track processing errors, and verify control effectiveness.

The report includes a formatted header with the report date, followed by detailed audit entries, error entries, and summary sections covering audit activity, error statistics, and control verification results.

## Program Structure

```mermaid
graph TD
    A[0000-MAIN] --> B[1000-INITIALIZE]
    A --> C[2000-PROCESS-REPORT]
    A --> D[3000-CLEANUP]
    
    B --> E[1100-OPEN-FILES]
    B --> F[1200-WRITE-HEADERS]
    E -->|Error| G[9999-ERROR-HANDLER]
    
    C --> H[2100-PROCESS-AUDIT-TRAIL]
    C --> I[2200-PROCESS-ERROR-LOG]
    C --> J[2300-WRITE-SUMMARY]
    
    H --> K[2110-READ-AUDIT-RECORDS]
    H --> L[2120-SUMMARIZE-AUDIT]
    
    I --> M[2210-READ-ERROR-RECORDS]
    I --> N[2220-SUMMARIZE-ERRORS]
    
    J --> O[2310-WRITE-AUDIT-SUMMARY]
    J --> P[2320-WRITE-ERROR-SUMMARY]
    J --> Q[2330-WRITE-CONTROL-SUMMARY]
    
    subgraph "Input Files"
        R[(AUDIT-FILE)]
        S[(ERROR-FILE)]
    end
    
    subgraph "Output"
        T[REPORT-FILE]
    end
    
    K -.-> R
    M -.-> S
    F -.-> T
    O -.-> T
    P -.-> T
    Q -.-> T
```

## Data Structures

### Working Storage

#### File Status Area

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 01 | WS-FILE-STATUS | | Group item for all file status codes |
| 05 | WS-AUDIT-STATUS | XX | File status for AUDIT-FILE operations |
| 05 | WS-ERROR-STATUS | XX | File status for ERROR-FILE operations |
| 05 | WS-REPORT-STATUS | XX | File status for REPORT-FILE operations |

#### Report Headers

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 01 | WS-REPORT-HEADERS | | Group item for report header lines |
| 05 | WS-HEADER1 | X(132) | Border line (asterisks) |
| 05 | WS-HEADER2 | X(132) | Title line: "SYSTEM AUDIT REPORT" |
| 05 | WS-HEADER3 | | Date line |
| 10 | WS-REPORT-DATE | X(10) | Report generation date |

#### Audit Detail Line

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 01 | WS-AUDIT-DETAIL | | Formatted audit record for report |
| 05 | WS-AUD-TIMESTAMP | X(26) | When the audit event occurred |
| 05 | WS-AUD-PROGRAM | X(8) | Program that generated the event |
| 05 | WS-AUD-TYPE | X(10) | Type of audit event |
| 05 | WS-AUD-MESSAGE | X(80) | Audit message text |

#### Error Detail Line

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 01 | WS-ERROR-DETAIL | | Formatted error record for report |
| 05 | WS-ERR-TIMESTAMP | X(26) | When the error occurred |
| 05 | WS-ERR-PROGRAM | X(8) | Program that encountered the error |
| 05 | WS-ERR-CODE | X(4) | Error code |
| 05 | WS-ERR-MESSAGE | X(80) | Error message text |

### File Section - AUDIT-RECORD (from AUDITLOG copybook)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 01 | AUDIT-RECORD | | Complete audit trail record |
| 05 | AUD-HEADER | | Header information |
| 10 | AUD-TIMESTAMP | X(26) | Event timestamp |
| 10 | AUD-SYSTEM-ID | X(8) | System identifier |
| 10 | AUD-USER-ID | X(8) | User who performed the action |
| 10 | AUD-PROGRAM | X(8) | Program name |
| 10 | AUD-TERMINAL | X(8) | Terminal identifier |
| 05 | AUD-TYPE | X(4) | Event type |
| 05 | AUD-ACTION | X(8) | Action performed |
| 05 | AUD-STATUS | X(4) | Result status |
| 05 | AUD-KEY-INFO | | Related entity information |
| 10 | AUD-PORTFOLIO-ID | X(8) | Portfolio ID if applicable |
| 10 | AUD-ACCOUNT-NO | X(10) | Account number if applicable |
| 05 | AUD-BEFORE-IMAGE | X(100) | Data before change |
| 05 | AUD-AFTER-IMAGE | X(100) | Data after change |
| 05 | AUD-MESSAGE | X(100) | Descriptive message |

**AUD-TYPE Values:**
- `TRAN` - Transaction event (AUD-TRANSACTION)
- `USER` - User action (AUD-USER-ACTION)
- `SYST` - System event (AUD-SYSTEM-EVENT)

**AUD-ACTION Values:**
- `CREATE` - Record created (AUD-CREATE)
- `UPDATE` - Record updated (AUD-UPDATE)
- `DELETE` - Record deleted (AUD-DELETE)
- `INQUIRE` - Record inquiry (AUD-INQUIRE)
- `LOGIN` - User login (AUD-LOGIN)
- `LOGOUT` - User logout (AUD-LOGOUT)
- `STARTUP` - System startup (AUD-STARTUP)
- `SHUTDOWN` - System shutdown (AUD-SHUTDOWN)

**AUD-STATUS Values:**
- `SUCC` - Success (AUD-SUCCESS)
- `FAIL` - Failure (AUD-FAILURE)
- `WARN` - Warning (AUD-WARNING)

### File Section - ERR-MESSAGE (from ERRHAND copybook)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 01 | ERR-MESSAGE | | Error message structure |
| 05 | ERR-TIMESTAMP | | When error occurred |
| 10 | ERR-DATE | X(10) | Error date |
| 10 | ERR-TIME | X(8) | Error time |
| 05 | ERR-PROGRAM | X(8) | Program that had the error |
| 05 | ERR-CATEGORY | X(2) | Error category |
| 05 | ERR-CODE | X(4) | Error code |
| 05 | ERR-SEVERITY | S9(4) COMP | Severity level |
| 05 | ERR-TEXT | X(80) | Error message text |
| 05 | ERR-DETAILS | X(256) | Extended error details |

**Error Categories:**
- `VS` - VSAM file errors
- `VL` - Validation errors
- `PR` - Processing errors
- `SY` - System errors

## File I/O

### Input Files

#### AUDIT-FILE

| Property | Value |
|----------|-------|
| Logical Name | AUDIT-FILE |
| Physical Assignment | AUDITLOG |
| Organization | Indexed (VSAM KSDS) |
| Access Mode | Sequential |
| Record Key | AUD-KEY |
| File Status | WS-AUDIT-STATUS |

This file contains the system audit trail records, tracking all significant events including user actions, transactions, and system events.

#### ERROR-FILE

| Property | Value |
|----------|-------|
| Logical Name | ERROR-FILE |
| Physical Assignment | ERRLOG |
| Organization | Indexed (VSAM KSDS) |
| Access Mode | Sequential |
| Record Key | ERR-KEY |
| File Status | WS-ERROR-STATUS |

This file contains error log records from all system programs, categorized by error type and severity.

### Output File

#### REPORT-FILE

| Property | Value |
|----------|-------|
| Logical Name | REPORT-FILE |
| Physical Assignment | RPTFILE |
| Organization | Sequential |
| Recording Mode | Fixed (F) |
| Record Length | 132 bytes |
| File Status | WS-REPORT-STATUS |

The output report file with 132-character fixed-length records suitable for standard print output.

## Control Flow

### Main Processing (0000-MAIN)

The program follows a standard batch processing pattern:

1. **Initialize** - Open files and write report headers
2. **Process** - Read and summarize audit and error data
3. **Cleanup** - Close all files and terminate

### Initialization (1000-INITIALIZE)

1. **1100-OPEN-FILES**: Opens all three files
   - AUDIT-FILE opened for input
   - ERROR-FILE opened for input
   - REPORT-FILE opened for output
   - If any file fails to open, control transfers to 9999-ERROR-HANDLER

2. **1200-WRITE-HEADERS**: Accepts current date and writes three header lines
   - Border line of asterisks
   - Centered title "SYSTEM AUDIT REPORT"
   - Report date line

### Report Processing (2000-PROCESS-REPORT)

Processing is divided into three phases:

1. **2100-PROCESS-AUDIT-TRAIL**: Processes audit log entries
   - 2110-READ-AUDIT-RECORDS: Reads all audit records sequentially
   - 2120-SUMMARIZE-AUDIT: Accumulates audit statistics

2. **2200-PROCESS-ERROR-LOG**: Processes error log entries
   - 2210-READ-ERROR-RECORDS: Reads all error records sequentially
   - 2220-SUMMARIZE-ERRORS: Accumulates error statistics

3. **2300-WRITE-SUMMARY**: Writes summary sections
   - 2310-WRITE-AUDIT-SUMMARY: Outputs audit activity summary
   - 2320-WRITE-ERROR-SUMMARY: Outputs error summary by category/severity
   - 2330-WRITE-CONTROL-SUMMARY: Outputs control verification results

### Error Handling (9999-ERROR-HANDLER)

When a file open error occurs:
1. Displays the error message
2. Sets RETURN-CODE to 12 (severe error)
3. Terminates the program with GOBACK

### Cleanup (3000-CLEANUP)

Closes all three files in a single CLOSE statement.

## Dependencies

### Copybooks
- AUDITLOG - Audit trail record structure definitions
- ERRHAND - Standard error handling and VSAM status definitions
- RTNCODE - Return code management structure

### Called Programs
None - This is a standalone batch report program.

### Related Programs
Programs that share copybooks with RPTAUD00:

**AUDITLOG copybook:**
- AUDPROC - Audit processing utility
- PORTTRAN - Portfolio transaction processing

**ERRHAND copybook:**
- BCHCTL00 - Batch control program
- HISTLD00 - History load program
- PRCSEQ00 - Sequential processing
- RCVPRC00 - Recovery processing
- RPTPOS00 - Position report
- RPTSTA00 - Status report
- DB2CMT, DB2CONN, DB2ERR, DB2STAT - DB2 utility programs
- ERRPROC - Error processing
- PORTTEST, PORTTRAN - Portfolio programs
- Various test and utility programs

**RTNCODE copybook:**
- RPTPOS00, RPTSTA00 - Other report programs
- RTNCDE00 - Return code analyzer
- Various test and utility programs

## JCL Requirements

Example JCL for executing RPTAUD00:

```jcl
//RPTAUD00 EXEC PGM=RPTAUD00
//STEPLIB  DD DSN=your.loadlib,DISP=SHR
//AUDITLOG DD DSN=your.audit.file,DISP=SHR
//ERRLOG   DD DSN=your.error.file,DISP=SHR
//RPTFILE  DD DSN=your.report.file,
//            DISP=(NEW,CATLG,DELETE),
//            DCB=(RECFM=FB,LRECL=132,BLKSIZE=0),
//            SPACE=(CYL,(1,1),RLSE)
//SYSOUT   DD SYSOUT=*
```

## Return Codes

| Code | Meaning |
|------|---------|
| 0 | Successful completion |
| 12 | Severe error (file open failure) |
