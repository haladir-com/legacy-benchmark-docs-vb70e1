---
title: "ERRHND"
description: "Online Error Handling Copybook - Data structures for CICS error handling and logging"
---

## Overview

ERRHND is a COBOL copybook that defines the standard data structures for error handling in online (CICS) programs. It provides a comprehensive framework for:

- **Error identification** - Program and paragraph where error occurred
- **Error codes** - SQL and CICS response codes
- **Severity classification** - Fatal, warning, or informational
- **Action specification** - Return, continue, or abend
- **Traceability** - Trace ID and timestamp for debugging

This copybook ensures consistent error handling across all online programs, enabling standardized error logging, debugging, and recovery procedures.

## Record Layout

```
+------------------+------------------+------------------+
|  ERR-PROGRAM     |  ERR-PARAGRAPH   |  ERR-SQLCODE     |
|   (8 bytes)      |   (30 bytes)     |   (4 bytes)      |
+------------------+------------------+------------------+
| ERR-CICS-RESP    | ERR-CICS-RESP2   |  ERR-SEVERITY    |
|   (4 bytes)      |   (4 bytes)      |   (1 byte)       |
+------------------+------------------+------------------+
|           ERR-MESSAGE (80 bytes)                       |
+-------------------------------------------------------+
|  ERR-ACTION  |           ERR-TRACE (42 bytes)         |
|   (1 byte)   |   TRACE-ID (16) + TIMESTAMP (26)       |
+------------------+------------------------------------+
```

**Total Structure Size**: 174 bytes

## Data Structures

### ERROR-HANDLING (Main Structure)

| Level | Name | Picture | Size | Description |
|-------|------|---------|------|-------------|
| 01 | ERROR-HANDLING | - | 174 | Complete error handling structure |
| 05 | ERR-PROGRAM | PIC X(8) | 8 | Program name where error occurred |
| 05 | ERR-PARAGRAPH | PIC X(30) | 30 | Paragraph name where error occurred |
| 05 | ERR-SQLCODE | PIC S9(9) COMP | 4 | DB2 SQLCODE value |
| 05 | ERR-CICS-RESP | PIC S9(8) COMP | 4 | CICS EIBRESP value |
| 05 | ERR-CICS-RESP2 | PIC S9(8) COMP | 4 | CICS EIBRESP2 value |
| 05 | ERR-SEVERITY | PIC X | 1 | Error severity level |
| 05 | ERR-MESSAGE | PIC X(80) | 80 | Descriptive error message |
| 05 | ERR-ACTION | PIC X | 1 | Action to take |
| 05 | ERR-TRACE | - | 42 | Traceability information |
| 10 | ERR-TRACE-ID | PIC X(16) | 16 | Unique trace identifier |
| 10 | ERR-TIMESTAMP | PIC X(26) | 26 | Error timestamp |

### Severity Levels (88-levels)

| Condition | Value | Description |
|-----------|-------|-------------|
| ERR-FATAL | 'F' | Fatal error - processing cannot continue |
| ERR-WARNING | 'W' | Warning - processing can continue with caution |
| ERR-INFO | 'I' | Informational - logged but no action required |

### Action Codes (88-levels)

| Condition | Value | Description |
|-----------|-------|-------------|
| ERR-RETURN | 'R' | Return to calling program |
| ERR-CONTINUE | 'C' | Continue processing |
| ERR-ABEND | 'A' | Abend the transaction |

## Field Details

### ERR-PROGRAM

The 8-character program name identifies the source of the error:
- Should match the PROGRAM-ID
- Enables quick identification in logs
- Used for error routing and notification

### ERR-PARAGRAPH

The 30-character paragraph name pinpoints the exact location:
- Helps developers locate the error source
- Should be the paragraph where the error was detected
- Can include section name if needed

### ERR-SQLCODE

The DB2 SQLCODE from the last SQL operation:
- `0` = Success
- Positive values = Warnings (e.g., `+100` = not found)
- Negative values = Errors (e.g., `-803` = duplicate key)

### ERR-CICS-RESP and ERR-CICS-RESP2

CICS response codes from the Execute Interface Block (EIB):
- **EIBRESP** - Primary response code
- **EIBRESP2** - Extended response code providing additional detail

Common EIBRESP values:
| Value | Name | Description |
|-------|------|-------------|
| 0 | NORMAL | Successful completion |
| 12 | FILENOTFOUND | File not found |
| 13 | NOTFND | Record not found |
| 14 | DUPREC | Duplicate record |
| 16 | INVREQ | Invalid request |
| 22 | PGMIDERR | Program not found |

### ERR-TRACE-ID

A 16-character unique identifier for tracing:
- Can be a GUID, transaction ID, or generated sequence
- Links related error records
- Enables end-to-end transaction tracing

### ERR-TIMESTAMP

A 26-character timestamp in DB2 format:
- Format: `YYYY-MM-DD-HH.MM.SS.NNNNNN`
- Enables precise error timing
- Supports audit and debugging requirements

## Usage Examples

### Basic Error Handling Setup

```cobol
WORKING-STORAGE SECTION.
    COPY ERRHND.

PROCEDURE DIVISION.
    EXEC CICS HANDLE CONDITION
        ERROR(9000-ERROR-HANDLER)
        PGMIDERR(9000-ERROR-HANDLER)
        NOTFND(9100-NOT-FOUND-HANDLER)
    END-EXEC
```

### Capturing a DB2 Error

```cobol
2000-READ-CUSTOMER.
    EXEC SQL
        SELECT CUST_NAME, CUST_ADDR
        INTO :WS-CUST-NAME, :WS-CUST-ADDR
        FROM CUSTOMER
        WHERE CUST_ID = :WS-CUST-ID
    END-EXEC
    
    IF SQLCODE NOT = 0
        MOVE 'CUSTINQ' TO ERR-PROGRAM
        MOVE '2000-READ-CUSTOMER' TO ERR-PARAGRAPH
        MOVE SQLCODE TO ERR-SQLCODE
        MOVE 0 TO ERR-CICS-RESP
        MOVE 0 TO ERR-CICS-RESP2
        
        IF SQLCODE = +100
            SET ERR-WARNING TO TRUE
            MOVE 'Customer not found' TO ERR-MESSAGE
            SET ERR-RETURN TO TRUE
        ELSE
            SET ERR-FATAL TO TRUE
            MOVE 'Database error reading customer' TO ERR-MESSAGE
            SET ERR-ABEND TO TRUE
        END-IF
        
        PERFORM 9000-LOG-ERROR
    END-IF
```

### Capturing a CICS Error

```cobol
3000-READ-FILE.
    EXEC CICS READ
        FILE('CUSTFILE')
        INTO(WS-CUSTOMER-RECORD)
        RIDFLD(WS-CUSTOMER-KEY)
        RESP(WS-RESP)
        RESP2(WS-RESP2)
    END-EXEC
    
    IF WS-RESP NOT = DFHRESP(NORMAL)
        MOVE 'CUSTMAINT' TO ERR-PROGRAM
        MOVE '3000-READ-FILE' TO ERR-PARAGRAPH
        MOVE 0 TO ERR-SQLCODE
        MOVE WS-RESP TO ERR-CICS-RESP
        MOVE WS-RESP2 TO ERR-CICS-RESP2
        
        EVALUATE WS-RESP
            WHEN DFHRESP(NOTFND)
                SET ERR-WARNING TO TRUE
                MOVE 'Record not found' TO ERR-MESSAGE
                SET ERR-RETURN TO TRUE
            WHEN DFHRESP(FILENOTFOUND)
                SET ERR-FATAL TO TRUE
                MOVE 'File not available' TO ERR-MESSAGE
                SET ERR-ABEND TO TRUE
            WHEN OTHER
                SET ERR-FATAL TO TRUE
                MOVE 'Unexpected CICS error' TO ERR-MESSAGE
                SET ERR-ABEND TO TRUE
        END-EVALUATE
        
        PERFORM 9000-LOG-ERROR
    END-IF
```

### Error Handler Paragraph

```cobol
9000-LOG-ERROR.
    *> Generate trace information
    MOVE EIBTRNID TO ERR-TRACE-ID(1:4)
    MOVE EIBTASKN TO ERR-TRACE-ID(5:8)
    ACCEPT ERR-TIMESTAMP FROM TIME
    
    *> Call error logging program
    EXEC CICS LINK
        PROGRAM('ERRHNDL')
        COMMAREA(ERROR-HANDLING)
        LENGTH(LENGTH OF ERROR-HANDLING)
    END-EXEC
    
    *> Take appropriate action
    EVALUATE TRUE
        WHEN ERR-ABEND
            EXEC CICS ABEND
                ABCODE('UERR')
            END-EXEC
        WHEN ERR-RETURN
            EXEC CICS RETURN END-EXEC
        WHEN ERR-CONTINUE
            CONTINUE
    END-EVALUATE
```

### Setting Informational Messages

```cobol
*> Log informational message for audit
MOVE 'AUDITPGM' TO ERR-PROGRAM
MOVE 'LOG-USER-ACTION' TO ERR-PARAGRAPH
MOVE 0 TO ERR-SQLCODE
MOVE 0 TO ERR-CICS-RESP
MOVE 0 TO ERR-CICS-RESP2
SET ERR-INFO TO TRUE
MOVE 'User completed portfolio transfer' TO ERR-MESSAGE
SET ERR-CONTINUE TO TRUE
PERFORM 9000-LOG-ERROR
```

## Programs Using This Copybook

| Program | Description |
|---------|-------------|
| DB2ONLN | DB2 online services - handles database errors |
| DB2RECV | DB2 recovery processing - manages recovery errors |
| ERRHNDL | Error handler program - central error logging |
| INQONLN | Online inquiry main handler - user-facing error handling |
| SECMGR | Security manager - security-related error handling |

## Integration with Error Handler

The ERROR-HANDLING structure is designed to be passed to the ERRHNDL program:

```cobol
EXEC CICS LINK
    PROGRAM('ERRHNDL')
    COMMAREA(ERROR-HANDLING)
    LENGTH(LENGTH OF ERROR-HANDLING)
END-EXEC
```

ERRHNDL typically:
1. Logs the error to a transient data queue or file
2. Sends notifications for fatal errors
3. Updates error statistics
4. Returns control based on ERR-ACTION

## Technical Notes

### Structure Size Calculation

| Field | Size |
|-------|------|
| ERR-PROGRAM | 8 bytes |
| ERR-PARAGRAPH | 30 bytes |
| ERR-SQLCODE | 4 bytes (COMP) |
| ERR-CICS-RESP | 4 bytes (COMP) |
| ERR-CICS-RESP2 | 4 bytes (COMP) |
| ERR-SEVERITY | 1 byte |
| ERR-MESSAGE | 80 bytes |
| ERR-ACTION | 1 byte |
| ERR-TRACE-ID | 16 bytes |
| ERR-TIMESTAMP | 26 bytes |
| **Total** | **174 bytes** |

### COMP Fields

The SQLCODE and CICS response fields use COMP (binary) format:
- `PIC S9(9) COMP` = 4 bytes, range ±999,999,999
- `PIC S9(8) COMP` = 4 bytes, range ±99,999,999

### Severity Guidelines

| Severity | When to Use | Typical Action |
|----------|-------------|----------------|
| Fatal | Unrecoverable errors, data corruption risks | Abend |
| Warning | Recoverable errors, business rule violations | Return |
| Info | Audit events, milestone logging | Continue |

### Error Message Best Practices

- Keep messages concise but descriptive
- Include relevant identifiers (customer ID, account number)
- Avoid technical jargon for user-facing messages
- Include error codes when helpful for support

### Trace ID Generation

Recommended trace ID format:
```
TTTTNNNNNNNNRRRR
│   │       │
│   │       └── Random/sequence (4 chars)
│   └────────── Task number (8 chars)
└────────────── Transaction ID (4 chars)
```

### Relationship to Batch Error Handling

Note: This copybook (ERRHND) is for **online/CICS** programs. A separate copybook (ERRHAND) exists for **batch** programs with similar but not identical structures. Ensure you use the correct copybook for your program type.
