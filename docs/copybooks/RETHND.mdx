---
title: "RETHND"
description: "Return Code Handling Definitions - provides standardized structures for return codes, error information, and recovery actions"
---

## Overview

RETHND (Return Handling) is a copybook that defines standardized data structures for managing return codes, error information, and recovery actions across COBOL programs. It provides a comprehensive framework for communicating processing outcomes between programs and modules.

The copybook includes three main components: a return status structure with standard return codes and module identification, a return details structure containing error location and descriptive information, and a return actions structure that controls retry behavior. Additionally, it defines a set of standard error codes for common error conditions.

This copybook is typically used in programs that need to communicate detailed error information to callers, particularly in checkpoint/restart scenarios where understanding the exact nature and location of errors is critical for recovery.

## Data Structures

### RETURN-HANDLING (Main Structure)

The primary data structure containing all return code handling fields.

```
01  RETURN-HANDLING.
    05  RETURN-STATUS.
        10  RETURN-CODE         PIC S9(4) COMP.
        10  REASON-CODE         PIC S9(4) COMP.
        10  MODULE-ID           PIC X(8).
        10  FUNCTION-ID         PIC X(8).
    05  RETURN-DETAILS.
        10  ERROR-LOCATION.
            15  PROGRAM-NAME    PIC X(8).
            15  PARAGRAPH-NAME  PIC X(8).
            15  ERROR-ROUTINE   PIC X(8).
        10  ERROR-INFO.
            15  ERROR-TYPE      PIC X(1).
            15  ERROR-CODE      PIC X(4).
            15  ERROR-TEXT      PIC X(80).
        10  SYSTEM-INFO.
            15  SYSTEM-CODE     PIC X(4).
            15  SYSTEM-MSG      PIC X(80).
    05  RETURN-ACTIONS.
        10  ACTION-FLAG         PIC X(1).
        10  RETRY-COUNT         PIC 9(2) COMP.
        10  MAX-RETRIES         PIC 9(2) COMP VALUE 3.
```

### RETURN-STATUS Group

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | RETURN-STATUS | - | Status information group |
| 10 | RETURN-CODE | S9(4) COMP | Primary return code |
| 10 | REASON-CODE | S9(4) COMP | Secondary reason code for detail |
| 10 | MODULE-ID | X(8) | Module/program identifier |
| 10 | FUNCTION-ID | X(8) | Function within the module |

### Return Code Values (88-level conditions)

| Value | Condition Name | Description |
|-------|----------------|-------------|
| +0 | RC-SUCCESS | Processing completed successfully |
| +4 | RC-WARNING | Warning condition, processing continued |
| +8 | RC-ERROR | Error occurred, processing may have stopped |
| +12 | RC-SEVERE | Severe error, processing stopped |
| +16 | RC-CRITICAL | Critical error, immediate termination |

### RETURN-DETAILS Group

#### ERROR-LOCATION Subgroup

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | ERROR-LOCATION | - | Where error occurred |
| 15 | PROGRAM-NAME | X(8) | Program name |
| 15 | PARAGRAPH-NAME | X(8) | Paragraph name |
| 15 | ERROR-ROUTINE | X(8) | Error handling routine name |

#### ERROR-INFO Subgroup

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | ERROR-INFO | - | Error details |
| 15 | ERROR-TYPE | X(1) | Error category code |
| 15 | ERROR-CODE | X(4) | Specific error code |
| 15 | ERROR-TEXT | X(80) | Human-readable error message |

#### Error Type Values (88-level conditions)

| Value | Condition Name | Description |
|-------|----------------|-------------|
| 'V' | ERR-VALIDATION | Data validation error |
| 'P' | ERR-PROCESSING | Processing logic error |
| 'D' | ERR-DATABASE | Database operation error |
| 'F' | ERR-FILE | File I/O error |
| 'S' | ERR-SECURITY | Security/authorization error |

#### SYSTEM-INFO Subgroup

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | SYSTEM-INFO | - | System-level error details |
| 15 | SYSTEM-CODE | X(4) | System error code (e.g., VSAM status, SQLCODE) |
| 15 | SYSTEM-MSG | X(80) | System error message |

### RETURN-ACTIONS Group

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 05 | RETURN-ACTIONS | - | - | Recovery action controls |
| 10 | ACTION-FLAG | X(1) | - | Recommended action |
| 10 | RETRY-COUNT | 9(2) COMP | - | Current retry attempt |
| 10 | MAX-RETRIES | 9(2) COMP | 3 | Maximum retry attempts allowed |

#### Action Flag Values (88-level conditions)

| Value | Condition Name | Description |
|-------|----------------|-------------|
| 'C' | ACTION-CONTINUE | Continue processing |
| 'A' | ACTION-ABORT | Abort processing |
| 'R' | ACTION-RETRY | Retry the operation |

## Standard Error Codes

The copybook defines a set of standard error codes for common error conditions:

```
01  STD-ERROR-CODES.
    05  ERR-INVALID-DATA    PIC X(4) VALUE 'E001'.
    05  ERR-NOT-FOUND       PIC X(4) VALUE 'E002'.
    05  ERR-DUPLICATE       PIC X(4) VALUE 'E003'.
    05  ERR-FILE-ERROR      PIC X(4) VALUE 'E004'.
    05  ERR-DB-ERROR        PIC X(4) VALUE 'E005'.
    05  ERR-SECURITY        PIC X(4) VALUE 'E006'.
    05  ERR-PROCESSING      PIC X(4) VALUE 'E007'.
    05  ERR-VALIDATION      PIC X(4) VALUE 'E008'.
    05  ERR-VERSION         PIC X(4) VALUE 'E009'.
    05  ERR-TIMEOUT         PIC X(4) VALUE 'E010'.
```

| Code | Name | Description |
|------|------|-------------|
| E001 | ERR-INVALID-DATA | Invalid input data format or content |
| E002 | ERR-NOT-FOUND | Requested record/resource not found |
| E003 | ERR-DUPLICATE | Duplicate record/key detected |
| E004 | ERR-FILE-ERROR | File operation failure |
| E005 | ERR-DB-ERROR | Database operation failure |
| E006 | ERR-SECURITY | Security or authorization failure |
| E007 | ERR-PROCESSING | General processing error |
| E008 | ERR-VALIDATION | Business rule validation failure |
| E009 | ERR-VERSION | Version mismatch or incompatibility |
| E010 | ERR-TIMEOUT | Operation timed out |

## Record Layout

```
+------------------------------------------------------------------+
| RETURN-HANDLING                                                   |
+------------------------------------------------------------------+
| RETURN-STATUS (24 bytes)                                         |
|   +------------------------------------------------------------+ |
|   | RETURN-CODE  | REASON-CODE  | MODULE-ID    | FUNCTION-ID   | |
|   | S9(4) COMP   | S9(4) COMP   | X(8)         | X(8)          | |
|   | (2 bytes)    | (2 bytes)    | (8 bytes)    | (8 bytes)     | |
|   +------------------------------------------------------------+ |
+------------------------------------------------------------------+
| RETURN-DETAILS (196 bytes)                                       |
|   +------------------------------------------------------------+ |
|   | ERROR-LOCATION (24 bytes)                                   | |
|   |   PROGRAM-NAME | PARAGRAPH-NAME | ERROR-ROUTINE             | |
|   |   X(8)         | X(8)           | X(8)                      | |
|   +------------------------------------------------------------+ |
|   | ERROR-INFO (85 bytes)                                       | |
|   |   ERROR-TYPE | ERROR-CODE | ERROR-TEXT                      | |
|   |   X(1)       | X(4)       | X(80)                           | |
|   +------------------------------------------------------------+ |
|   | SYSTEM-INFO (84 bytes)                                      | |
|   |   SYSTEM-CODE | SYSTEM-MSG                                  | |
|   |   X(4)        | X(80)                                       | |
|   +------------------------------------------------------------+ |
+------------------------------------------------------------------+
| RETURN-ACTIONS (5 bytes)                                         |
|   +------------------------------------------------------------+ |
|   | ACTION-FLAG | RETRY-COUNT  | MAX-RETRIES                    | |
|   | X(1)        | 9(2) COMP    | 9(2) COMP                      | |
|   | (1 byte)    | (2 bytes)    | (2 bytes)                      | |
|   +------------------------------------------------------------+ |
+------------------------------------------------------------------+
Total: ~225 bytes
```

## Usage Example

From the copybook's embedded documentation:

```cobol
WORKING-STORAGE SECTION.
    COPY RETHND.

PROCEDURE DIVISION.
    ...
    IF SOME-VALIDATION-FAILS
        MOVE 'PORTMSTR'   TO MODULE-ID
        MOVE 'VALIDATE'   TO FUNCTION-ID
        MOVE 'E001'       TO ERROR-CODE
        SET ERR-VALIDATION TO TRUE
        SET RC-ERROR      TO TRUE
        MOVE 'Invalid portfolio ID' TO ERROR-TEXT
        
        MOVE 'PORTMSTR' TO PROGRAM-NAME
        MOVE 'P200-VAL' TO PARAGRAPH-NAME
        MOVE 'ERR-HAND' TO ERROR-ROUTINE
        
        SET ACTION-ABORT TO TRUE
    END-IF
    ...
```

### Complete Error Setup Example

```cobol
* Set up return status
MOVE ZERO TO RETURN-CODE
MOVE ZERO TO REASON-CODE
MOVE 'CKPRST  ' TO MODULE-ID
MOVE 'RESTART ' TO FUNCTION-ID

* Set error location
MOVE 'CKPRST  ' TO PROGRAM-NAME
MOVE 'P500-CHK' TO PARAGRAPH-NAME
MOVE 'ERR-RTN ' TO ERROR-ROUTINE

* Set error information
SET ERR-FILE TO TRUE
MOVE ERR-FILE-ERROR TO ERROR-CODE
MOVE 'Checkpoint file read error' TO ERROR-TEXT

* Set system information
MOVE WS-FILE-STATUS TO SYSTEM-CODE
MOVE 'VSAM status 23 - record not found' TO SYSTEM-MSG

* Set return code and action
SET RC-ERROR TO TRUE
SET ACTION-RETRY TO TRUE
ADD 1 TO RETRY-COUNT

* Check if retries exceeded
IF RETRY-COUNT > MAX-RETRIES
    SET ACTION-ABORT TO TRUE
END-IF
```

## Programs Using This Copybook

| Program | Description |
|---------|-------------|
| CKPRST | Checkpoint/Restart utility |

## Related Copybooks

| Copybook | Relationship |
|----------|--------------|
| ERRHAND | Alternative error handling for batch programs |
| ERRHND | Online error handling for CICS programs |
| RTNCODE | Return code management with analysis features |

## Technical Notes

### Return Code Hierarchy

The return codes follow the standard mainframe convention:

| Code | Severity | Typical Action |
|------|----------|----------------|
| 0 | Success | Continue normally |
| 4 | Warning | Continue, but log/note condition |
| 8 | Error | Stop current operation, may continue job |
| 12 | Severe | Stop job step |
| 16 | Critical | Immediate termination |

### Retry Logic

The RETURN-ACTIONS group supports automatic retry handling:

```cobol
* Example retry loop
PERFORM UNTIL ACTION-ABORT OR RC-SUCCESS
    PERFORM SOME-OPERATION
    
    IF RC-ERROR AND ACTION-RETRY
        ADD 1 TO RETRY-COUNT
        IF RETRY-COUNT > MAX-RETRIES
            SET ACTION-ABORT TO TRUE
        END-IF
    END-IF
END-PERFORM
```

### Error Type Categories

The ERROR-TYPE field categorizes errors for routing and handling:

- **V (Validation)**: Input data issues - may be correctable
- **P (Processing)**: Logic or business rule issues
- **D (Database)**: DB2/SQL errors - may need DBA attention
- **F (File)**: VSAM/QSAM errors - may be recoverable
- **S (Security)**: Authorization failures - needs security review

### Checkpoint/Restart Integration

This copybook is designed to work with checkpoint/restart processing:

1. Store RETURN-HANDLING in checkpoint records
2. On restart, read checkpoint and examine error details
3. Use ACTION-FLAG to determine recovery strategy
4. Track RETRY-COUNT across restart attempts

### COBOL Features Used

- **88-level condition names**: Used for return codes (RC-SUCCESS, etc.), error types (ERR-VALIDATION, etc.), and actions (ACTION-CONTINUE, etc.)
- **COMP (COMPUTATIONAL)**: Binary storage for numeric fields (2 bytes for S9(4) COMP)
- **VALUE clause**: Default value of 3 for MAX-RETRIES
- **Hierarchical group structure**: Three levels of grouping for organized data access
