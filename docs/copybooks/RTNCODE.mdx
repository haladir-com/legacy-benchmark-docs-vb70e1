---
title: "RTNCODE"
description: "Return Code Management Copybook - Standardized structure for managing, tracking, and analyzing return codes across batch and utility programs"
---

## Overview

RTNCODE is a copybook that provides a standardized framework for managing return codes across the portfolio management system. It defines data structures for tracking current and highest return codes, determining status levels, logging return codes to a database, and analyzing historical return code patterns.

The copybook supports five operations through a request-type interface:
- **Initialize** - Reset return code tracking
- **Set Code** - Record a new return code and update highest
- **Get Code** - Retrieve current return code information
- **Log Code** - Persist return code to database for audit
- **Analyze** - Query historical return codes for a program

This standardized approach ensures consistent return code handling across all programs, enabling centralized monitoring, reporting, and problem diagnosis.

## Record Layout

### RETURN-CODE-AREA (01 Level)

```
01  RETURN-CODE-AREA.
    05  RC-REQUEST-TYPE.
    05  RC-PROGRAM-ID.
    05  RC-CODES-AREA.
    05  RC-MESSAGE.
    05  RC-RESPONSE-CODE.
    05  RC-ANALYSIS-DATA.
    05  RC-RETURN-DATA.
```

## Data Structures

### RC-REQUEST-TYPE - Operation Selector

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | RC-REQUEST-TYPE | X | Operation type code |

#### Request Type Values

| Value | 88-Level Name | Description |
|-------|---------------|-------------|
| I | RC-INITIALIZE | Initialize/reset return code tracking |
| S | RC-SET-CODE | Set a new return code |
| G | RC-GET-CODE | Get current return code values |
| L | RC-LOG-CODE | Log return code to database |
| A | RC-ANALYZE | Analyze historical return codes |

### RC-PROGRAM-ID - Program Identifier

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | RC-PROGRAM-ID | X(8) | Program name for tracking |

### RC-CODES-AREA - Return Code Values

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | RC-CODES-AREA | | Return codes group |
| 10 | RC-CURRENT-CODE | S9(4) COMP | Current return code |
| 10 | RC-HIGHEST-CODE | S9(4) COMP | Highest return code seen |
| 10 | RC-NEW-CODE | S9(4) COMP | New code to set (input) |
| 10 | RC-STATUS | X | Status classification |

#### RC-STATUS Values

| Value | 88-Level Name | Return Code Range | Description |
|-------|---------------|-------------------|-------------|
| S | RC-STATUS-SUCCESS | 0 | Successful completion |
| W | RC-STATUS-WARNING | 1-4 | Completed with warnings |
| E | RC-STATUS-ERROR | 5-8 | Completed with errors |
| F | RC-STATUS-SEVERE | 9+ | Severe/fatal error |

### RC-MESSAGE - Message Text

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | RC-MESSAGE | X(80) | Descriptive message for the return code |

### RC-RESPONSE-CODE - Operation Response

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | RC-RESPONSE-CODE | S9(8) COMP | Response from operation (0=success) |

### RC-ANALYSIS-DATA - Analysis Parameters/Results

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | RC-ANALYSIS-DATA | | Analysis group |
| 10 | RC-START-TIME | X(26) | Start of analysis period |
| 10 | RC-END-TIME | X(26) | End of analysis period |
| 10 | RC-TOTAL-CODES | S9(8) COMP | Count of return codes in period |
| 10 | RC-MAX-CODE | S9(4) COMP | Maximum return code in period |
| 10 | RC-MIN-CODE | S9(4) COMP | Minimum return code in period |

### RC-RETURN-DATA - Retrieved Values

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | RC-RETURN-DATA | | Retrieved values group |
| 10 | RC-RETURN-VALUE | S9(4) COMP | Retrieved current code |
| 10 | RC-HIGHEST-RETURN | S9(4) COMP | Retrieved highest code |
| 10 | RC-RETURN-STATUS | X | Retrieved status |

## Operations

### Initialize (RC-INITIALIZE)

Resets all return code tracking fields to initial state:

```cobol
SET RC-INITIALIZE TO TRUE
CALL 'RTNCDE00' USING RETURN-CODE-AREA
```

**Effect:**
- RC-CURRENT-CODE = 0
- RC-HIGHEST-CODE = 0
- RC-STATUS = 'S' (Success)
- RC-RESPONSE-CODE = 0

### Set Code (RC-SET-CODE)

Records a new return code and updates the highest code if needed:

```cobol
MOVE 'MYPROG01' TO RC-PROGRAM-ID
MOVE 4 TO RC-NEW-CODE
MOVE 'Minor validation warning' TO RC-MESSAGE
SET RC-SET-CODE TO TRUE
CALL 'RTNCDE00' USING RETURN-CODE-AREA
```

**Effect:**
- RC-CURRENT-CODE = RC-NEW-CODE
- RC-HIGHEST-CODE = MAX(RC-HIGHEST-CODE, RC-NEW-CODE)
- RC-STATUS set based on code range
- RC-RESPONSE-CODE = 0

### Get Code (RC-GET-CODE)

Retrieves current return code information:

```cobol
SET RC-GET-CODE TO TRUE
CALL 'RTNCDE00' USING RETURN-CODE-AREA

* Results available in:
*   RC-RETURN-VALUE   - Current code
*   RC-HIGHEST-RETURN - Highest code seen
*   RC-RETURN-STATUS  - Status classification
```

### Log Code (RC-LOG-CODE)

Persists the current return code to the RTNCODES database table:

```cobol
MOVE 'MYPROG01' TO RC-PROGRAM-ID
MOVE 'Processing completed with warnings' TO RC-MESSAGE
SET RC-LOG-CODE TO TRUE
CALL 'RTNCDE00' USING RETURN-CODE-AREA

IF RC-RESPONSE-CODE NOT = 0
    DISPLAY 'Failed to log return code'
END-IF
```

**Database Record:**
- TIMESTAMP
- PROGRAM_ID
- RETURN_CODE
- HIGHEST_CODE
- STATUS_CODE
- MESSAGE_TEXT

### Analyze (RC-ANALYZE)

Queries historical return codes for a program within a time range:

```cobol
MOVE 'MYPROG01' TO RC-PROGRAM-ID
MOVE '2024-03-01-00.00.00.000000' TO RC-START-TIME
MOVE '2024-03-31-23.59.59.999999' TO RC-END-TIME
SET RC-ANALYZE TO TRUE
CALL 'RTNCDE00' USING RETURN-CODE-AREA

* Results available in:
*   RC-TOTAL-CODES - Number of executions
*   RC-MAX-CODE    - Worst return code
*   RC-MIN-CODE    - Best return code
```

## Programs Using This Copybook

| Program | Category | Usage |
|---------|----------|-------|
| RTNCDE00 | Batch | Return code handler - implements the operations |
| RPTAUD00 | Batch | Audit reporting - tracks report generation status |
| RPTPOS00 | Batch | Position reporting - tracks report status |
| RPTSTA00 | Batch | Status reporting - tracks processing status |
| TSTGEN00 | Test | Test generation - tracks test execution |
| TSTVAL00 | Test | Test validation - tracks validation results |
| UTLMNT00 | Utility | File maintenance - tracks maintenance operations |
| UTLMON00 | Utility | System monitoring - tracks monitoring status |
| UTLVAL00 | Utility | Data validation - tracks validation results |

## Usage Examples

### Basic Return Code Tracking

```cobol
WORKING-STORAGE SECTION.
    COPY RTNCODE.

PROCEDURE DIVISION.
    * Initialize at program start
    SET RC-INITIALIZE TO TRUE
    MOVE 'MYPROG01' TO RC-PROGRAM-ID
    CALL 'RTNCDE00' USING RETURN-CODE-AREA
    
    * Process records, setting codes as needed
    PERFORM PROCESS-RECORDS
    
    * Check results
    SET RC-GET-CODE TO TRUE
    CALL 'RTNCDE00' USING RETURN-CODE-AREA
    
    EVALUATE TRUE
        WHEN RC-STATUS-SUCCESS
            DISPLAY 'Processing completed successfully'
        WHEN RC-STATUS-WARNING
            DISPLAY 'Processing completed with warnings'
        WHEN RC-STATUS-ERROR
            DISPLAY 'Processing completed with errors'
        WHEN RC-STATUS-SEVERE
            DISPLAY 'Processing failed'
    END-EVALUATE
    
    * Set program return code
    MOVE RC-HIGHEST-RETURN TO RETURN-CODE
    
    GOBACK.

PROCESS-RECORDS.
    * On warning condition
    IF minor-issue
        MOVE 4 TO RC-NEW-CODE
        MOVE 'Minor data issue encountered' TO RC-MESSAGE
        SET RC-SET-CODE TO TRUE
        CALL 'RTNCDE00' USING RETURN-CODE-AREA
    END-IF
    
    * On error condition
    IF error-condition
        MOVE 8 TO RC-NEW-CODE
        MOVE 'Error processing record' TO RC-MESSAGE
        SET RC-SET-CODE TO TRUE
        CALL 'RTNCDE00' USING RETURN-CODE-AREA
    END-IF
    .
```

### Logging Return Codes for Audit

```cobol
* At end of processing, log the final status
MOVE 'Batch processing complete' TO RC-MESSAGE
SET RC-LOG-CODE TO TRUE
CALL 'RTNCDE00' USING RETURN-CODE-AREA
```

### Analyzing Historical Performance

```cobol
* Analyze last 30 days of return codes
MOVE 'MYPROG01' TO RC-PROGRAM-ID
COMPUTE start-date = FUNCTION CURRENT-DATE - 30
MOVE start-date TO RC-START-TIME
MOVE FUNCTION CURRENT-DATE TO RC-END-TIME
SET RC-ANALYZE TO TRUE
CALL 'RTNCDE00' USING RETURN-CODE-AREA

DISPLAY 'Executions: ' RC-TOTAL-CODES
DISPLAY 'Max RC: ' RC-MAX-CODE
DISPLAY 'Min RC: ' RC-MIN-CODE
```

## Related Copybooks

| Copybook | Relationship |
|----------|--------------|
| ERRHAND | Error handling - complements RTNCODE for error management |
| RETHND | Return handling - alternative return status structure |

## Technical Notes

### Return Code Conventions

The copybook follows IBM mainframe return code conventions:

| Code | Severity | Meaning |
|------|----------|---------|
| 0 | Success | Processing completed successfully |
| 4 | Warning | Minor issues, processing continued |
| 8 | Error | Significant issues, some processing may have failed |
| 12 | Severe | Major failure, processing terminated |
| 16 | Critical | Catastrophic failure |

### Highest Code Tracking

The `RC-HIGHEST-CODE` field tracks the worst return code seen during execution. This is crucial because:
- Multiple operations may set different codes
- The program's final return code should reflect the worst outcome
- JCL COND parameters typically check against the highest code

### Status Classification Logic

The RTNCDE00 program classifies return codes as follows:
```cobol
EVALUATE RC-NEW-CODE
    WHEN 0
        SET RC-STATUS-SUCCESS TO TRUE
    WHEN 1 THRU 4
        SET RC-STATUS-WARNING TO TRUE
    WHEN 5 THRU 8
        SET RC-STATUS-ERROR TO TRUE
    WHEN OTHER
        SET RC-STATUS-SEVERE TO TRUE
END-EVALUATE
```

### Database Table Structure

The RTNCODES table (used by RC-LOG-CODE and RC-ANALYZE) should have:
```sql
CREATE TABLE RTNCODES (
    TIMESTAMP       CHAR(26) NOT NULL,
    PROGRAM_ID      CHAR(8) NOT NULL,
    RETURN_CODE     SMALLINT,
    HIGHEST_CODE    SMALLINT,
    STATUS_CODE     CHAR(1),
    MESSAGE_TEXT    VARCHAR(80)
);

CREATE INDEX RTNCODES_X1 
    ON RTNCODES (PROGRAM_ID, TIMESTAMP);
```

### Timestamp Format

Time fields use ISO 8601 format with microseconds:
```
YYYY-MM-DD-HH.MM.SS.FFFFFF
```
Example: `2024-03-20-14.30.25.123456`

### Thread Safety

Each program instance maintains its own copy of RETURN-CODE-AREA in working storage, making this approach thread-safe for multi-task environments.
