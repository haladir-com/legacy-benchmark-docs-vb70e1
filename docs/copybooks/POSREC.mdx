---
title: "POSREC"
description: "Position Record Structure - defines investment holdings with quantity, cost basis, market value, and audit information"
---

## Overview

POSREC is a copybook that defines the standard Position Record structure used to track investment holdings within the portfolio management system. Each position record represents a specific investment holding for a portfolio on a given date, containing quantity, cost basis, market value, and status information.

The position record serves as a fundamental data structure for portfolio valuation, performance reporting, and transaction processing. It supports multi-currency portfolios and maintains a complete audit trail of maintenance activities.

## Record Layout

```
+------------------------------------------------------------------+
| POSITION-RECORD (approximately 150 bytes)                        |
+------------------------------------------------------------------+
| POS-KEY (26 bytes)                                               |
|   +------------------------------------------------------------+ |
|   | POS-PORTFOLIO-ID (8) | POS-DATE (8) | POS-INVESTMENT-ID(10)| |
|   +------------------------------------------------------------+ |
+------------------------------------------------------------------+
| POS-DATA (36 bytes)                                              |
|   +------------------------------------------------------------+ |
|   | POS-QUANTITY (8)   | POS-COST-BASIS (8) | POS-MARKET-VAL(8)| |
|   | POS-CURRENCY (3)   | POS-STATUS (1)                        | |
|   +------------------------------------------------------------+ |
+------------------------------------------------------------------+
| POS-AUDIT (34 bytes)                                             |
|   +------------------------------------------------------------+ |
|   | POS-LAST-MAINT-DATE (26) | POS-LAST-MAINT-USER (8)         | |
|   +------------------------------------------------------------+ |
+------------------------------------------------------------------+
| POS-FILLER (50 bytes)                                            |
+------------------------------------------------------------------+
```

## Data Structure

### POSITION-RECORD (Level 01)

The main position record containing all investment holding information.

### POS-KEY Group (Level 05)

The composite primary key uniquely identifying each position.

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | POS-KEY | - | Composite record key |
| 10 | POS-PORTFOLIO-ID | X(8) | Portfolio identifier |
| 10 | POS-DATE | X(8) | Position date (YYYYMMDD format) |
| 10 | POS-INVESTMENT-ID | X(10) | Investment/security identifier |

### POS-DATA Group (Level 05)

The core position data fields.

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | POS-DATA | - | Position data group |
| 10 | POS-QUANTITY | S9(11)V9(4) COMP-3 | Holding quantity (supports fractional shares) |
| 10 | POS-COST-BASIS | S9(13)V9(2) COMP-3 | Total cost basis (purchase cost) |
| 10 | POS-MARKET-VALUE | S9(13)V9(2) COMP-3 | Current market value |
| 10 | POS-CURRENCY | X(3) | ISO currency code (e.g., USD, EUR, GBP) |
| 10 | POS-STATUS | X(1) | Position status code |

**POS-STATUS 88-Level Condition Names:**

| Condition | Value | Description |
|-----------|-------|-------------|
| POS-STATUS-ACTIVE | 'A' | Active position |
| POS-STATUS-CLOSED | 'C' | Closed/liquidated position |
| POS-STATUS-PEND | 'P' | Pending settlement |

### POS-AUDIT Group (Level 05)

Audit trail information for the position record.

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | POS-AUDIT | - | Audit information group |
| 10 | POS-LAST-MAINT-DATE | X(26) | Last maintenance timestamp |
| 10 | POS-LAST-MAINT-USER | X(8) | User ID who last modified |

### POS-FILLER (Level 05)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | POS-FILLER | X(50) | Reserved for future expansion |

## Field Specifications

### Numeric Field Details

| Field | Bytes | Decimal | Max Value | Notes |
|-------|-------|---------|-----------|-------|
| POS-QUANTITY | 8 | 4 | 99,999,999,999.9999 | Supports fractional shares |
| POS-COST-BASIS | 8 | 2 | 9,999,999,999,999.99 | Total cost, not per-share |
| POS-MARKET-VALUE | 8 | 2 | 9,999,999,999,999.99 | Current total value |

### Date Formats

| Field | Format | Example |
|-------|--------|---------|
| POS-DATE | YYYYMMDD | '20240315' |
| POS-LAST-MAINT-DATE | Timestamp (26) | '2024-03-15-14.30.45.123456' |

### Currency Codes

Common ISO 4217 currency codes used:

| Code | Currency |
|------|----------|
| USD | US Dollar |
| EUR | Euro |
| GBP | British Pound |
| JPY | Japanese Yen |
| CAD | Canadian Dollar |

## Usage Examples

### Reading a Position Record

```cobol
WORKING-STORAGE SECTION.
    COPY POSREC.
    
PROCEDURE DIVISION.
    MOVE 'PORT0001' TO POS-PORTFOLIO-ID
    MOVE '20240315' TO POS-DATE
    MOVE 'AAPL      ' TO POS-INVESTMENT-ID
    
    READ POSITION-MASTER
        INVALID KEY
            DISPLAY 'Position not found'
    END-READ
    
    IF POS-STATUS-ACTIVE
        COMPUTE WS-GAIN-LOSS = 
            POS-MARKET-VALUE - POS-COST-BASIS
    END-IF
```

### Creating a New Position

```cobol
    INITIALIZE POSITION-RECORD
    
    MOVE 'PORT0001'    TO POS-PORTFOLIO-ID
    MOVE WS-TODAY      TO POS-DATE
    MOVE 'MSFT      '  TO POS-INVESTMENT-ID
    MOVE 100.0000      TO POS-QUANTITY
    MOVE 25000.00      TO POS-COST-BASIS
    MOVE 27500.00      TO POS-MARKET-VALUE
    MOVE 'USD'         TO POS-CURRENCY
    SET POS-STATUS-ACTIVE TO TRUE
    
    ACCEPT POS-LAST-MAINT-DATE FROM TIME STAMP
    MOVE WS-USER-ID    TO POS-LAST-MAINT-USER
    
    WRITE POSITION-RECORD
        INVALID KEY
            PERFORM HANDLE-DUPLICATE-KEY
    END-WRITE
```

### Calculating Unrealized Gain/Loss

```cobol
    COMPUTE WS-UNREALIZED-GAIN = 
        POS-MARKET-VALUE - POS-COST-BASIS
    
    COMPUTE WS-GAIN-PERCENT = 
        (WS-UNREALIZED-GAIN / POS-COST-BASIS) * 100
    
    IF WS-UNREALIZED-GAIN < 0
        DISPLAY 'Loss: ' WS-UNREALIZED-GAIN
    ELSE
        DISPLAY 'Gain: ' WS-UNREALIZED-GAIN
    END-IF
```

### Using Status Conditions

```cobol
    EVALUATE TRUE
        WHEN POS-STATUS-ACTIVE
            PERFORM PROCESS-ACTIVE-POSITION
        WHEN POS-STATUS-CLOSED
            PERFORM PROCESS-CLOSED-POSITION
        WHEN POS-STATUS-PEND
            PERFORM PROCESS-PENDING-POSITION
    END-EVALUATE
```

## Programs Using This Copybook

### RPTPOS00 - Daily Position Report Generator

**Location**: `/src/programs/batch/RPTPOS00.cbl`

**Usage**: Uses POSREC in the FILE SECTION to read position records from an indexed VSAM file for report generation.

```cobol
FILE SECTION.
    COPY POSREC.
    
FILE-CONTROL.
    SELECT POSITION-MASTER ASSIGN TO POSMSTRE
        ORGANIZATION IS INDEXED
        ACCESS MODE IS SEQUENTIAL
        RECORD KEY IS POS-KEY
        FILE STATUS IS WS-POSITION-STATUS.
```

**Key Operations**:
- Sequential read of all position records
- Formats position data for daily position report
- Calculates change percentages from previous values
- Generates summary totals and exception reports

### INQPORT - Portfolio Position Inquiry (CICS)

**Location**: `/src/programs/online/INQPORT.cbl`

**Usage**: Uses POSREC in WORKING-STORAGE for online inquiry of position data via CICS.

```cobol
WORKING-STORAGE SECTION.
01  WS-POSITION-RECORD.
    COPY POSREC.
```

**Key Operations**:
- Reads position records via CICS FILE commands
- Formats position data for BMS map display
- Handles not-found and error conditions
- Returns position data through COMMAREA

### UTLVAL00 - Data Validation Utility

**Location**: `/src/programs/utility/UTLVAL00.cbl`

**Usage**: Uses POSREC in the FILE SECTION to validate position data integrity.

```cobol
FILE SECTION.
    COPY POSREC.
    
FILE-CONTROL.
    SELECT POSITION-MASTER ASSIGN TO POSMSTRE
        ORGANIZATION IS INDEXED
        ACCESS MODE IS DYNAMIC
        RECORD KEY IS POS-KEY
        FILE STATUS IS WS-POS-STATUS.
```

**Key Operations**:
- Validates position record integrity
- Cross-references positions with transactions
- Verifies format compliance
- Reconciles position balances
- Reports validation errors

## File Organization

The POSREC copybook is typically used with VSAM KSDS (Key-Sequenced Data Set) files:

```cobol
SELECT POSITION-MASTER
    ASSIGN TO POSMSTRE
    ORGANIZATION IS INDEXED
    ACCESS MODE IS DYNAMIC
    RECORD KEY IS POS-KEY
    FILE STATUS IS WS-POS-STATUS.
```

### Key Structure

The composite key (POS-KEY) enables:
- **By Portfolio**: Retrieve all positions for a portfolio
- **By Date**: Get positions as of a specific date
- **Specific Position**: Direct access to a single holding

### Access Patterns

| Access Mode | Use Case |
|-------------|----------|
| SEQUENTIAL | Reports, batch processing |
| RANDOM | Online inquiries, updates |
| DYNAMIC | Mixed batch/random access |

## Validation Rules

### Required Fields

| Field | Rule |
|-------|------|
| POS-PORTFOLIO-ID | Must not be spaces |
| POS-DATE | Must be valid YYYYMMDD |
| POS-INVESTMENT-ID | Must not be spaces |
| POS-CURRENCY | Must be valid ISO code |
| POS-STATUS | Must be 'A', 'C', or 'P' |

### Business Rules

| Rule | Description |
|------|-------------|
| Quantity Sign | Can be negative for short positions |
| Cost Basis | Typically positive; negative for shorts |
| Market Value | Should match quantity Ã— current price |
| Closed Positions | Should have zero quantity |

## Technical Notes

- **COMP-3 (Packed Decimal)**: Numeric fields use packed decimal for efficient storage and precise decimal arithmetic
- **Key Design**: 26-byte composite key allows efficient retrieval by portfolio, date, or investment
- **Filler Space**: 50-byte filler provides room for future field additions without file conversion
- **Timestamp Format**: POS-LAST-MAINT-DATE uses 26-byte DB2-compatible timestamp format
- **Signed Numerics**: All numeric fields are signed (S prefix) to support short positions and adjustments
- **4 Decimal Places**: POS-QUANTITY supports fractional shares common in mutual funds
- **Record Size**: Approximately 150 bytes (varies slightly based on COMP-3 storage)

## Related Copybooks

| Copybook | Relationship |
|----------|--------------|
| TRNREC | Transaction records that update positions |
| PORTFLIO | Portfolio master containing position totals |
| HISTREC | Historical position snapshots |
