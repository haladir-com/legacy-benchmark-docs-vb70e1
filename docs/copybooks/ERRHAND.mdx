---
title: "ERRHAND"
description: "Standard Error Handling Definitions - common error categories, return codes, and VSAM status handling"
---

## Overview

ERRHAND is a foundational copybook that provides standardized error handling definitions used throughout the application portfolio. It establishes common error categories, standard return codes, error message structures, and VSAM status handling constants.

This copybook is one of the most widely used in the system, included by 19 programs spanning batch processing, database operations, reporting, utilities, and testing. Its consistent use ensures uniform error handling and reporting across all application components.

## Data Structures

### Error Categories (ERR-CATEGORIES)

Defines standard two-character codes for classifying errors by source:

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 01 | ERR-CATEGORIES | - | - | Error category constants |
| 05 | ERR-CAT-VSAM | X(2) | `'VS'` | VSAM/File I/O errors |
| 05 | ERR-CAT-VALID | X(2) | `'VL'` | Validation errors |
| 05 | ERR-CAT-PROC | X(2) | `'PR'` | Processing/business logic errors |
| 05 | ERR-CAT-SYSTEM | X(2) | `'SY'` | System-level errors |

#### Category Usage Guidelines

| Category | Code | Use For |
|----------|------|---------|
| VSAM | `'VS'` | File open/close failures, read/write errors, status codes |
| Validation | `'VL'` | Data validation failures, format errors, range checks |
| Processing | `'PR'` | Business rule violations, calculation errors, logic failures |
| System | `'SY'` | Resource exhaustion, system calls, environment issues |

### Standard Return Codes (ERR-RETURN-CODES)

Defines the standard mainframe return code values:

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 01 | ERR-RETURN-CODES | - | - | Return code constants |
| 05 | ERR-SUCCESS | S9(4) COMP | +0 | Successful completion |
| 05 | ERR-WARNING | S9(4) COMP | +4 | Warning - processing completed with issues |
| 05 | ERR-ERROR | S9(4) COMP | +8 | Error - significant problem occurred |
| 05 | ERR-SEVERE | S9(4) COMP | +12 | Severe error - critical failure |
| 05 | ERR-TERMINAL | S9(4) COMP | +16 | Terminal error - immediate abort required |

#### Return Code Guidelines

| Code | Level | JCL Behavior | Recommended Action |
|------|-------|--------------|-------------------|
| 0 | Success | Continue | Normal processing |
| 4 | Warning | Continue | Review output, may need attention |
| 8 | Error | Typically stop | Investigate before continuing |
| 12 | Severe | Stop | Critical issue, manual intervention |
| 16 | Terminal | Stop | Fatal error, abort job stream |

### Error Message Structure (ERR-MESSAGE)

Provides a standardized structure for error information:

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 01 | ERR-MESSAGE | - | Error message work area |
| 05 | ERR-TIMESTAMP | - | Timestamp group |
| 10 | ERR-DATE | X(10) | Error date (YYYY-MM-DD) |
| 10 | ERR-TIME | X(8) | Error time (HH:MM:SS) |
| 05 | ERR-PROGRAM | X(8) | Program that detected error |
| 05 | ERR-CATEGORY | X(2) | Error category code |
| 05 | ERR-CODE | X(4) | Application-specific error code |
| 05 | ERR-SEVERITY | S9(4) COMP | Severity level |
| 05 | ERR-TEXT | X(80) | Short error message |
| 05 | ERR-DETAILS | X(256) | Extended error details |

#### ERR-MESSAGE Layout

```
┌─────────────────────────────────────────────────────────────────┐
│                        ERR-MESSAGE                               │
├──────────────────────────────────────┬──────────────────────────┤
│ ERR-TIMESTAMP (18 bytes)             │                          │
│ ├── ERR-DATE (10)                    │ ERR-PROGRAM (8)          │
│ └── ERR-TIME (8)                     │                          │
├──────────────────────────────────────┴──────────────────────────┤
│ ERR-CATEGORY (2) │ ERR-CODE (4) │ ERR-SEVERITY (2 COMP)        │
├─────────────────────────────────────────────────────────────────┤
│ ERR-TEXT (80 bytes)                                             │
├─────────────────────────────────────────────────────────────────┤
│ ERR-DETAILS (256 bytes)                                         │
└─────────────────────────────────────────────────────────────────┘
```

### VSAM Status Handling (ERR-VSAM-STATUSES)

Provides constants for common VSAM file status codes:

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 01 | ERR-VSAM-STATUSES | - | - | VSAM status constants |
| 05 | ERR-VSAM-SUCCESS | X(2) | `'00'` | Successful operation |
| 05 | ERR-VSAM-DUPKEY | X(2) | `'22'` | Duplicate key on write |
| 05 | ERR-VSAM-NOTFND | X(2) | `'23'` | Record not found |
| 05 | ERR-VSAM-EOF | X(2) | `'10'` | End of file reached |

### VSAM Error Messages (ERR-VSAM-MSGS)

Pre-defined error messages for common VSAM errors:

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 01 | ERR-VSAM-MSGS | - | - | VSAM error message texts |
| 05 | ERR-VSAM-22 | X(80) | `'Duplicate record key'` | Message for status 22 |
| 05 | ERR-VSAM-23 | X(80) | `'Record not found'` | Message for status 23 |
| 05 | ERR-OTHER | X(80) | `'Unexpected VSAM error'` | Generic error message |

## Usage Examples

### Setting Up an Error Message

```cobol
WORKING-STORAGE SECTION.
    COPY ERRHAND.

PROCEDURE DIVISION.
    ...
    * Record a validation error
    ACCEPT ERR-DATE FROM DATE YYYYMMDD
    ACCEPT ERR-TIME FROM TIME
    MOVE 'PORTMSTR' TO ERR-PROGRAM
    MOVE ERR-CAT-VALID TO ERR-CATEGORY
    MOVE 'V001' TO ERR-CODE
    MOVE ERR-ERROR TO ERR-SEVERITY
    MOVE 'Invalid portfolio ID format' TO ERR-TEXT
    MOVE 'Portfolio ID must be 8 characters, alphanumeric'
      TO ERR-DETAILS
    
    PERFORM WRITE-ERROR-LOG
    ...
```

### Handling VSAM Status Codes

```cobol
    READ PORTFOLIO-FILE INTO WS-PORTFOLIO-RECORD
    
    EVALUATE WS-FILE-STATUS
        WHEN ERR-VSAM-SUCCESS
            CONTINUE
        WHEN ERR-VSAM-NOTFND
            MOVE ERR-VSAM-23 TO ERR-TEXT
            MOVE ERR-CAT-VSAM TO ERR-CATEGORY
            PERFORM HANDLE-NOT-FOUND
        WHEN ERR-VSAM-EOF
            SET END-OF-FILE TO TRUE
        WHEN OTHER
            MOVE ERR-OTHER TO ERR-TEXT
            STRING 'VSAM Status: ' WS-FILE-STATUS
                   DELIMITED SIZE INTO ERR-DETAILS
            PERFORM HANDLE-VSAM-ERROR
    END-EVALUATE
```

### Setting Return Codes

```cobol
    * Normal completion
    MOVE ERR-SUCCESS TO RETURN-CODE
    GOBACK
    
    * Warning condition
    IF WS-WARNING-COUNT > 0
        MOVE ERR-WARNING TO RETURN-CODE
    END-IF
    
    * Error handling
    IF WS-ERROR-OCCURRED
        MOVE ERR-ERROR TO RETURN-CODE
        PERFORM LOG-ERROR-AND-EXIT
    END-IF
    
    * Severe error - abort processing
    IF WS-CRITICAL-FAILURE
        MOVE ERR-SEVERE TO RETURN-CODE
        DISPLAY 'CRITICAL ERROR - ABORTING'
        PERFORM EMERGENCY-CLEANUP
        GOBACK
    END-IF
```

### Calling ERRPROC Service

```cobol
01  WS-ERROR-REQUEST.
    05  WS-PROGRAM-ID      PIC X(8).
    05  WS-CATEGORY        PIC X(2).
    05  WS-ERROR-CODE      PIC X(4).
    05  WS-SEVERITY        PIC S9(4) COMP.
    05  WS-ERROR-TEXT      PIC X(80).
    05  WS-ERROR-DETAILS   PIC X(256).
    05  WS-RETURN-CODE     PIC S9(4) COMP.

PROCEDURE DIVISION.
    ...
    * Log error via ERRPROC service
    MOVE 'PORTUPDT' TO WS-PROGRAM-ID
    MOVE ERR-CAT-PROC TO WS-CATEGORY
    MOVE 'P001' TO WS-ERROR-CODE
    MOVE ERR-ERROR TO WS-SEVERITY
    MOVE 'Update failed - record locked' TO WS-ERROR-TEXT
    MOVE 'Portfolio: ' & PORT-ID & ' locked by user ' & LOCK-USER
      TO WS-ERROR-DETAILS
    
    CALL 'ERRPROC' USING WS-ERROR-REQUEST
    ...
```

## Error Code Standards

### Recommended Error Code Format

Error codes in ERR-CODE should follow a consistent pattern:

| Position | Content | Example |
|----------|---------|---------|
| 1 | Category indicator | V=Validation, P=Processing, F=File, S=System |
| 2-4 | Numeric sequence | 001-999 |

### Example Error Codes

| Code | Category | Description |
|------|----------|-------------|
| V001 | Validation | Invalid field format |
| V002 | Validation | Required field missing |
| V003 | Validation | Value out of range |
| P001 | Processing | Record locked |
| P002 | Processing | Business rule violation |
| P003 | Processing | Calculation error |
| F001 | File | File not found |
| F002 | File | I/O error |
| F003 | File | End of file unexpected |
| S001 | System | Resource unavailable |
| S002 | System | Timeout |
| S003 | System | Memory allocation failed |

## Programs Using This Copybook

ERRHAND is used by 19 programs across the application:

### Batch Processing
| Program | Purpose |
|---------|---------|
| BCHCTL00 | Batch control management |
| HISTLD00 | History data loading |
| PRCSEQ00 | Process sequencing |
| RCVPRC00 | Recovery processing |

### Reporting
| Program | Purpose |
|---------|---------|
| RPTAUD00 | Audit reporting |
| RPTPOS00 | Position reporting |
| RPTSTA00 | Status reporting |

### Database Operations
| Program | Purpose |
|---------|---------|
| DB2CMT | DB2 commit handling |
| DB2CONN | DB2 connection management |
| DB2ERR | DB2 error handling |
| DB2STAT | DB2 statistics |

### Core Services
| Program | Purpose |
|---------|---------|
| ERRPROC | Error processing service |

### Portfolio Processing
| Program | Purpose |
|---------|---------|
| PORTTEST | Portfolio testing |
| PORTTRAN | Portfolio transactions |

### Testing & Utilities
| Program | Purpose |
|---------|---------|
| TSTGEN00 | Test data generation |
| TSTVAL00 | Test validation |
| UTLMNT00 | Maintenance utility |
| UTLMON00 | Monitoring utility |
| UTLVAL00 | Validation utility |

## Related Copybooks

| Copybook | Relationship |
|----------|--------------|
| RTNCODE | Complements ERRHAND with return code management |
| ERRHND | Online/CICS version of error handling (different copybook) |
| RETHND | Return handling for checkpoint/restart |

## Technical Notes

### COBOL Constructs Used

- **VALUE Clause**: All constants are initialized with VALUE clauses, making them immediately usable without runtime initialization.

- **COMP Fields**: ERR-SEVERITY and return code fields use COMP (binary) format for efficient comparison and arithmetic operations.

- **Group-Level Organization**: Related fields are grouped (ERR-CATEGORIES, ERR-RETURN-CODES, etc.) for logical organization and potential group-level operations.

### Record Size

| Structure | Size (bytes) |
|-----------|--------------|
| ERR-CATEGORIES | 8 |
| ERR-RETURN-CODES | ~10 (COMP fields) |
| ERR-MESSAGE | ~370 |
| ERR-VSAM-STATUSES | 8 |
| ERR-VSAM-MSGS | 240 |

### JCL Return Code Handling

The return codes defined in this copybook align with standard JCL COND parameter conventions:

```jcl
//STEP02   EXEC PGM=NEXTPROG,
//         COND=(8,LT)    Skip if prior RC >= 8
//STEP03   EXEC PGM=CLEANUP,
//         COND=(4,LT)    Skip if prior RC >= 4
//STEP04   EXEC PGM=ALWAYS,
//         COND=EVEN      Run even if prior steps failed
```

### Best Practices

1. **Always use constants**: Use ERR-SUCCESS, ERR-ERROR, etc. instead of literal values
2. **Populate all fields**: Fill in ERR-MESSAGE completely for comprehensive error logging
3. **Use appropriate categories**: Choose the correct ERR-CAT-* for accurate error classification
4. **Include context**: Put key values and identifiers in ERR-DETAILS for debugging
5. **Log before exit**: Write error information before setting return code and exiting
