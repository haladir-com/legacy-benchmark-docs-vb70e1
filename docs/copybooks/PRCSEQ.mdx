---
title: "PRCSEQ"
description: "Process Sequence Definitions - defines batch process sequencing records with timing, dependencies, scheduling, and recovery information"
---

## Overview

PRCSEQ is a copybook that defines the data structures for batch process sequencing and control. It provides the record layout for storing process definitions that control the order of execution, dependencies between processes, scheduling rules, and recovery options for batch job processing.

This copybook is central to the batch processing infrastructure, enabling:
- **Process Orchestration** - Defining the sequence of batch processes
- **Dependency Management** - Specifying prerequisites between processes
- **Schedule Control** - Setting timing, frequency, and calendar rules
- **Recovery Configuration** - Defining restart and error handling behavior

## Data Structures

### Process Sequence Record (PROCESS-SEQUENCE-RECORD)

The main record structure for storing process definitions:

```
+------------------------------------------------------------------+
|                    PROCESS-SEQUENCE-RECORD                        |
+------------------------------------------------------------------+
| PSR-KEY (10)                                                      |
|   +-- PSR-PROCESS-ID (8) + PSR-VERSION (2)                       |
+------------------------------------------------------------------+
| PSR-DATA                                                          |
|   +-- PSR-DESCRIPTION (30)                                        |
|   +-- PSR-TYPE (3)                                               |
|   +-- PSR-TIMING                                                  |
|   +-- PSR-DEPENDENCIES                                            |
|   +-- PSR-CONTROL                                                 |
+------------------------------------------------------------------+
| PSR-SCHEDULE                                                      |
+------------------------------------------------------------------+
| PSR-RECOVERY                                                      |
+------------------------------------------------------------------+
| PSR-AUDIT                                                         |
+------------------------------------------------------------------+
| PSR-FILLER (50)                                                   |
+------------------------------------------------------------------+
```

### Record Key (PSR-KEY)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PSR-KEY | - | Composite primary key |
| 10 | PSR-PROCESS-ID | X(8) | Unique process identifier |
| 10 | PSR-VERSION | 9(2) | Version number for process definition |

### Process Data (PSR-DATA)

#### Basic Information

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | PSR-DESCRIPTION | X(30) | Human-readable process description |
| 10 | PSR-TYPE | X(3) | Process type code |
| 88 | PSR-TYPE-INIT | VALUE 'INI' | Initialization process |
| 88 | PSR-TYPE-PROC | VALUE 'PRC' | Main processing process |
| 88 | PSR-TYPE-RPT | VALUE 'RPT' | Reporting process |
| 88 | PSR-TYPE-TERM | VALUE 'TRM' | Termination process |

#### Timing Information (PSR-TIMING)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | PSR-TIMING | - | Timing control group |
| 15 | PSR-FREQ | X(1) | Execution frequency |
| 88 | PSR-DAILY | VALUE 'D' | Run daily |
| 88 | PSR-WEEKLY | VALUE 'W' | Run weekly |
| 88 | PSR-MONTHLY | VALUE 'M' | Run monthly |
| 15 | PSR-START-TIME | 9(4) | Earliest start time (HHMM) |
| 15 | PSR-MAX-TIME | 9(4) | Maximum allowed runtime (minutes) |

#### Dependencies (PSR-DEPENDENCIES)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | PSR-DEPENDENCIES | - | Dependency information group |
| 15 | PSR-DEP-COUNT | 9(2) COMP | Number of dependencies (0-10) |
| 15 | PSR-DEP-ENTRY | OCCURS 10 TIMES | Dependency entries array |
| 20 | PSR-DEP-ID | X(8) | Dependent process ID |
| 20 | PSR-DEP-TYPE | X(1) | Dependency type |
| 88 | PSR-DEP-HARD | VALUE 'H' | Hard dependency (must complete) |
| 88 | PSR-DEP-SOFT | VALUE 'S' | Soft dependency (preferred) |
| 20 | PSR-DEP-RC | S9(4) COMP | Maximum acceptable return code |

#### Control Information (PSR-CONTROL)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 10 | PSR-CONTROL | - | Execution control group |
| 15 | PSR-PROGRAM | X(8) | Program name to execute |
| 15 | PSR-PARM | X(50) | Parameters to pass to program |
| 15 | PSR-MAX-RC | S9(4) COMP | Maximum acceptable return code |
| 15 | PSR-RESTART | X(1) | Restart capability flag |
| 88 | PSR-RESTARTABLE | VALUE 'Y' | Process can be restarted |
| 88 | PSR-NO-RESTART | VALUE 'N' | Process cannot be restarted |

### Schedule Information (PSR-SCHEDULE)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PSR-SCHEDULE | - | Scheduling rules group |
| 10 | PSR-ACTIVE-DAYS | X(7) | Day-of-week flags (Sun-Sat: Y/N) |
| 88 | PSR-WEEKDAY | VALUE 'YYYYYNN' | Monday through Friday |
| 88 | PSR-WEEKEND | VALUE 'NNNNNYY' | Saturday and Sunday |
| 88 | PSR-ALL-DAYS | VALUE 'YYYYYYY' | Every day |
| 10 | PSR-MONTH-END | X(1) | Month-end processing flag |
| 88 | PSR-LAST-DAY | VALUE 'Y' | Run on last day of month |
| 10 | PSR-HOLIDAY-RUN | X(1) | Holiday processing rule |
| 88 | PSR-SKIP-HOL | VALUE 'N' | Skip on holidays |
| 88 | PSR-RUN-HOL | VALUE 'Y' | Run on holidays |

### Recovery Information (PSR-RECOVERY)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PSR-RECOVERY | - | Recovery options group |
| 10 | PSR-RECOVERY-PGM | X(8) | Recovery program name |
| 10 | PSR-RECOVERY-PARM | X(50) | Recovery program parameters |
| 10 | PSR-ERROR-LIMIT | 9(4) COMP | Maximum errors before abort |

### Audit Information (PSR-AUDIT)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PSR-AUDIT | - | Audit trail group |
| 10 | PSR-CREATE-DATE | X(10) | Record creation date (YYYY-MM-DD) |
| 10 | PSR-CREATE-USER | X(8) | User who created record |
| 10 | PSR-UPDATE-DATE | X(10) | Last update date |
| 10 | PSR-UPDATE-USER | X(8) | User who last updated |

### Reserved Space

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PSR-FILLER | X(50) | Reserved for future use |

## Standard Sequences (STANDARD-SEQUENCES)

The copybook also defines standard process sequence constants:

### Start of Day Sequence (SEQ-START-OF-DAY)

| Position | Value | Description |
|----------|-------|-------------|
| 1-8 | 'INITDAY ' | Day initialization |
| 9-16 | 'CKPCLR  ' | Checkpoint clear |
| 17-24 | 'DATEVAL ' | Date validation |

### Main Process Sequence (SEQ-MAIN-PROCESS)

| Position | Value | Description |
|----------|-------|-------------|
| 1-8 | 'TRNVAL00' | Transaction validation |
| 9-16 | 'POSUPD00' | Position update |
| 17-24 | 'HISTLD00' | History load |

### End of Day Sequence (SEQ-END-OF-DAY)

| Position | Value | Description |
|----------|-------|-------------|
| 1-8 | 'RPTGEN00' | Report generation |
| 9-16 | 'BCKLOD00' | Backup load |
| 17-24 | 'ENDDAY  ' | Day termination |

## Usage

### File Definition

```cobol
FILE-CONTROL.
    SELECT PROCESS-SEQ-FILE
        ASSIGN TO PRCSEQ
        ORGANIZATION IS INDEXED
        ACCESS MODE IS DYNAMIC
        RECORD KEY IS PSR-KEY
        FILE STATUS IS WS-PSR-STATUS.

FILE SECTION.
FD  PROCESS-SEQ-FILE.
    COPY PRCSEQ.
```

### Working-Storage Usage

```cobol
WORKING-STORAGE SECTION.
01  WS-PROCESS-DEF.
    COPY PRCSEQ.
```

### Reading a Process Definition

```cobol
MOVE 'TRNVAL00' TO PSR-PROCESS-ID
MOVE 01 TO PSR-VERSION

READ PROCESS-SEQ-FILE
    INVALID KEY
        DISPLAY 'Process not found'
    NOT INVALID KEY
        DISPLAY 'Process: ' PSR-DESCRIPTION
        DISPLAY 'Program: ' PSR-PROGRAM
END-READ
```

### Checking Dependencies

```cobol
PERFORM VARYING WS-IX FROM 1 BY 1
        UNTIL WS-IX > PSR-DEP-COUNT
    
    IF PSR-DEP-HARD(WS-IX)
        DISPLAY 'Hard dependency: ' PSR-DEP-ID(WS-IX)
        DISPLAY 'Max RC allowed: ' PSR-DEP-RC(WS-IX)
    END-IF
END-PERFORM
```

### Checking Schedule

```cobol
* Check if process runs on weekdays only
IF PSR-WEEKDAY
    DISPLAY 'Process runs Monday-Friday'
END-IF

* Check if process can run on holidays
IF PSR-SKIP-HOL
    DISPLAY 'Process will be skipped on holidays'
END-IF
```

## Programs Using This Copybook

### PRCSEQ00 - Process Sequence Manager

Uses PRCSEQ to:
- Build execution sequences from process definitions
- Check process dependencies before execution
- Create batch control records for each process
- Track process status through execution

Key operations:
- `READ PROCESS-SEQ-FILE` - Retrieve process definitions
- `START PROCESS-SEQ-FILE KEY >= PSR-KEY` - Position for sequential read
- Uses `PSR-TYPE` to filter processes by type
- Uses `PSR-DEP-COUNT` and `PSR-DEP-ENTRY` to check dependencies
- Uses `PSR-RESTARTABLE` flag for recovery decisions

### RCVPRC00 - Process Recovery Handler

Uses PRCSEQ to:
- Look up recovery configuration for failed processes
- Determine if a process can be restarted
- Execute recovery programs when defined

Key operations:
- `READ PROCESS-SEQ-FILE` - Get process definition for recovery
- Uses `PSR-RESTARTABLE` to determine recovery action
- Uses `PSR-RECOVERY-PGM` and `PSR-RECOVERY-PARM` for custom recovery
- Uses `PSR-ERROR-LIMIT` to control retry attempts

## Dependency Types

### Hard Dependencies (PSR-DEP-HARD)

Hard dependencies **must** complete successfully before the dependent process can start:

```
Process A (PSR-DEP-HARD) ──must complete──> Process B
```

- If dependency fails or exceeds `PSR-DEP-RC`, dependent process is blocked
- Used for data dependencies (e.g., load must complete before processing)

### Soft Dependencies (PSR-DEP-SOFT)

Soft dependencies are **preferred** but not required:

```
Process A (PSR-DEP-SOFT) ──preferred──> Process B
```

- Process can start even if soft dependency hasn't completed
- Used for optimization (e.g., prefer to run after related process)

## Process Types

| Type | Code | Purpose | Example |
|------|------|---------|---------|
| Initialization | INI | Setup and preparation | Environment setup, date validation |
| Processing | PRC | Main business logic | Transaction processing, calculations |
| Reporting | RPT | Output generation | Reports, extracts, notifications |
| Termination | TRM | Cleanup and finalization | Backup, archival, status updates |

## Schedule Configuration

### Day-of-Week Flags (PSR-ACTIVE-DAYS)

The 7-character field represents Sunday through Saturday:

| Position | Day | Example (Weekday) |
|----------|-----|-------------------|
| 1 | Sunday | N |
| 2 | Monday | Y |
| 3 | Tuesday | Y |
| 4 | Wednesday | Y |
| 5 | Thursday | Y |
| 6 | Friday | Y |
| 7 | Saturday | N |

### Timing Fields

- **PSR-START-TIME**: Earliest time process can start (HHMM format)
  - Example: `0600` = 6:00 AM
- **PSR-MAX-TIME**: Maximum runtime in minutes
  - Example: `0120` = 2 hours maximum

## Record Layout Summary

| Field Group | Bytes | Description |
|-------------|-------|-------------|
| PSR-KEY | 10 | Process ID + Version |
| PSR-DATA | ~180 | Description, type, timing, dependencies, control |
| PSR-SCHEDULE | 9 | Active days, month-end, holiday rules |
| PSR-RECOVERY | 62 | Recovery program, parms, error limit |
| PSR-AUDIT | 36 | Create/update dates and users |
| PSR-FILLER | 50 | Reserved |
| **Total** | ~347 | Approximate record length |

## Related Copybooks

| Copybook | Relationship |
|----------|--------------|
| BCHCTL | Batch control records track execution of processes defined in PRCSEQ |
| BCHCON | Batch constants used with PRCSEQ (status codes, return codes) |
| ERRHAND | Error handling for PRCSEQ file operations |

## Best Practices

1. **Version Control**: Use PSR-VERSION to maintain multiple versions of process definitions during transitions

2. **Dependency Depth**: Limit dependency chains to avoid complex debugging; prefer flat structures

3. **Recovery Programs**: Always define PSR-RECOVERY-PGM for critical processes

4. **Error Limits**: Set PSR-ERROR-LIMIT appropriately to prevent infinite retry loops

5. **Restart Flags**: Mark PSR-NO-RESTART for processes with side effects (e.g., sending notifications)

6. **Audit Trail**: Always populate PSR-AUDIT fields for change tracking
