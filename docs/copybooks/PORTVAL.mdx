---
title: "PORTVAL"
description: "Portfolio Validation Rules and Error Messages - defines return codes, error messages, validation constants, and work areas for portfolio data validation"
---

## Overview

PORTVAL is a copybook that provides a standardized framework for validating portfolio data elements. It defines return codes, error messages, validation constants, and work areas used by portfolio validation routines.

The copybook supports validation of:
- **Portfolio IDs**: Format validation (must start with 'PORT' prefix)
- **Account Numbers**: Numeric format validation
- **Investment Types**: Valid type code checking
- **Monetary Amounts**: Range validation within system limits

By centralizing validation rules and messages in a copybook, the system ensures consistent error handling and makes it easy to update validation logic across all programs.

## Data Structures

### Validation Return Codes (VAL-RETURN-CODES)

Standardized return codes for validation results:

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 01 | VAL-RETURN-CODES | Group | | Validation return code constants |
| 05 | VAL-SUCCESS | S9(4) | +0 | Validation passed |
| 05 | VAL-INVALID-ID | S9(4) | +1 | Portfolio ID format invalid |
| 05 | VAL-INVALID-ACCT | S9(4) | +2 | Account number format invalid |
| 05 | VAL-INVALID-TYPE | S9(4) | +3 | Investment type code invalid |
| 05 | VAL-INVALID-AMT | S9(4) | +4 | Amount outside valid range |

### Validation Error Messages (VAL-ERROR-MESSAGES)

Pre-defined error messages for each validation failure:

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 01 | VAL-ERROR-MESSAGES | Group | | Error message constants |
| 05 | VAL-ERR-ID | X(50) | 'Invalid Portfolio ID format' | Portfolio ID error |
| 05 | VAL-ERR-ACCT | X(50) | 'Invalid Account Number format' | Account number error |
| 05 | VAL-ERR-TYPE | X(50) | 'Invalid Investment Type' | Investment type error |
| 05 | VAL-ERR-AMT | X(50) | 'Amount outside valid range' | Amount range error |

### Validation Constants (VAL-CONSTANTS)

Business rule constants for validation logic:

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 01 | VAL-CONSTANTS | Group | | Validation rule constants |
| 05 | VAL-MIN-AMOUNT | S9(13)V99 | -9999999999999.99 | Minimum valid amount |
| 05 | VAL-MAX-AMOUNT | S9(13)V99 | +9999999999999.99 | Maximum valid amount |
| 05 | VAL-ID-PREFIX | X(4) | 'PORT' | Required Portfolio ID prefix |

### Validation Work Areas (VAL-WORK-AREAS)

Working storage fields for validation processing:

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 01 | VAL-WORK-AREAS | Group | Validation working storage |
| 05 | VAL-NUMERIC-CHECK | X(10) | Field for numeric validation testing |
| 05 | VAL-TEMP-NUM | S9(13)V99 | Temporary numeric field for amount validation |
| 05 | VAL-ERROR-CODE | S9(4) | Current error code during validation |
| 05 | VAL-ERROR-MSG | X(50) | Current error message during validation |

## Validation Rules

### Portfolio ID Validation

Portfolio IDs must conform to the following rules:
1. Must start with the prefix 'PORT' (defined in `VAL-ID-PREFIX`)
2. Must be followed by exactly 4 numeric digits
3. Example valid IDs: `PORT0001`, `PORT1234`, `PORT9999`

```cobol
* Check prefix
IF INPUT-ID(1:4) NOT = VAL-ID-PREFIX
    MOVE VAL-INVALID-ID TO RETURN-CODE
    MOVE VAL-ERR-ID TO ERROR-MSG
END-IF

* Check numeric suffix
IF INPUT-ID(5:4) IS NOT NUMERIC
    MOVE VAL-INVALID-ID TO RETURN-CODE
    MOVE VAL-ERR-ID TO ERROR-MSG
END-IF
```

### Account Number Validation

Account numbers must be:
1. Exactly 10 numeric digits
2. Non-zero value

```cobol
IF ACCOUNT-NUMBER IS NOT NUMERIC
OR ACCOUNT-NUMBER = ZEROS
    MOVE VAL-INVALID-ACCT TO RETURN-CODE
    MOVE VAL-ERR-ACCT TO ERROR-MSG
END-IF
```

### Investment Type Validation

Investment type codes must be one of the following valid values:

| Code | Description |
|------|-------------|
| STK | Stocks/Equities |
| BND | Bonds/Fixed Income |
| MMF | Money Market Funds |
| ETF | Exchange-Traded Funds |

```cobol
IF INVEST-TYPE NOT = 'STK'
   AND NOT = 'BND'
   AND NOT = 'MMF'
   AND NOT = 'ETF'
    MOVE VAL-INVALID-TYPE TO RETURN-CODE
    MOVE VAL-ERR-TYPE TO ERROR-MSG
END-IF
```

### Amount Validation

Monetary amounts must fall within the system's valid range:
- **Minimum**: -9,999,999,999,999.99 (`VAL-MIN-AMOUNT`)
- **Maximum**: +9,999,999,999,999.99 (`VAL-MAX-AMOUNT`)

This range supports values up to approximately ±10 trillion with 2 decimal places.

```cobol
IF AMOUNT < VAL-MIN-AMOUNT
OR AMOUNT > VAL-MAX-AMOUNT
    MOVE VAL-INVALID-AMT TO RETURN-CODE
    MOVE VAL-ERR-AMT TO ERROR-MSG
END-IF
```

## Usage

### Including the Copybook

```cobol
WORKING-STORAGE SECTION.
    COPY PORTVAL.
```

### Basic Validation Pattern

```cobol
* Validate a portfolio ID
IF WS-PORTFOLIO-ID(1:4) NOT = VAL-ID-PREFIX
    MOVE VAL-INVALID-ID TO WS-RETURN-CODE
    MOVE VAL-ERR-ID TO WS-ERROR-MESSAGE
    PERFORM ERROR-HANDLING
END-IF
```

### Using with Validation Subroutine

The PORTVALD program provides a callable interface for validation:

```cobol
* Set up validation request
MOVE 'I' TO LS-VALIDATE-TYPE    *> 'I' = ID validation
MOVE WS-PORTFOLIO-ID TO LS-INPUT-VALUE

* Call validation subroutine
CALL 'PORTVALD' USING LS-VALIDATION-REQUEST

* Check result
IF LS-RETURN-CODE NOT = VAL-SUCCESS
    DISPLAY 'Validation failed: ' LS-ERROR-MSG
    PERFORM ERROR-HANDLING
END-IF
```

### Validation Type Codes

When calling PORTVALD, use these type codes:

| Code | Constant | Validation Performed |
|------|----------|---------------------|
| 'I' | LS-VAL-ID | Portfolio ID format |
| 'A' | LS-VAL-ACCT | Account number format |
| 'T' | LS-VAL-TYPE | Investment type code |
| 'M' | LS-VAL-AMT | Amount range |

## Programs Using This Copybook

| Program | Purpose | Usage |
|---------|---------|-------|
| PORTVALD | Portfolio Validation Subroutine | Uses all structures - return codes, error messages, constants, and work areas to perform validation |

## Related Copybooks

| Copybook | Relationship |
|----------|--------------|
| PORTFLIO | Portfolio master record - contains fields that are validated using PORTVAL rules |
| ERRHAND | Error handling - may be used alongside PORTVAL for error logging |

## Design Notes

### Extensibility

To add a new validation type:
1. Add a new return code constant to `VAL-RETURN-CODES`
2. Add a corresponding error message to `VAL-ERROR-MESSAGES`
3. Add any needed constants to `VAL-CONSTANTS`
4. Update PORTVALD or create a new validation paragraph

### Return Code Ordering

Return codes are assigned sequentially starting from 0:
- 0 = Success (validation passed)
- 1-4 = Specific validation failures

This ordering allows for simple success checking (`IF RETURN-CODE = VAL-SUCCESS`) and range-based error categorization.

### Message Length

All error messages are defined as `PIC X(50)`, providing:
- Consistent field sizing across all messages
- Sufficient space for descriptive error text
- Easy mapping to display fields and log records

### Amount Precision

The amount validation fields use `PIC S9(13)V99`:
- 13 integer digits for large values
- 2 decimal places for currency precision
- Signed to support both debits and credits
- Range of ±9,999,999,999,999.99

This matches the financial field definitions in PORTFLIO and other portfolio-related copybooks.
