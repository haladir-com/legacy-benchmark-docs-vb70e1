---
title: "ERRHAND"
description: "Standard error handling definitions copybook providing error categories, return codes, message structures, and VSAM status handling"
---

## Overview

ERRHAND is a foundational copybook that provides standardized error handling definitions for batch programs across the portfolio management system. It establishes consistent patterns for error categorization, return codes, message formatting, and VSAM file status handling.

This copybook is one of the most widely used in the system, included by 19 programs spanning batch processing, DB2 operations, reporting, utilities, and testing. By centralizing error handling definitions, ERRHAND ensures:

- **Consistent Error Classification**: Standard categories for different error types
- **Uniform Return Codes**: Standard severity levels understood by job schedulers
- **Structured Error Messages**: Common format for error logging and reporting
- **VSAM Status Handling**: Pre-defined statuses and messages for file operations

## Data Structures

### Error Categories (ERR-CATEGORIES)

Defines two-character codes for classifying errors by source:

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 01 | ERR-CATEGORIES | - | - | Error category group |
| 05 | ERR-CAT-VSAM | X(2) | 'VS' | VSAM file operation errors |
| 05 | ERR-CAT-VALID | X(2) | 'VL' | Data validation errors |
| 05 | ERR-CAT-PROC | X(2) | 'PR' | Processing/business logic errors |
| 05 | ERR-CAT-SYSTEM | X(2) | 'SY' | System/environment errors |

### Standard Return Codes (ERR-RETURN-CODES)

Defines standard return codes compatible with IBM mainframe job scheduling conventions:

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 01 | ERR-RETURN-CODES | - | - | Return code group |
| 05 | ERR-SUCCESS | S9(4) COMP | +0 | Successful completion |
| 05 | ERR-WARNING | S9(4) COMP | +4 | Warning - processing continued |
| 05 | ERR-ERROR | S9(4) COMP | +8 | Error - partial processing |
| 05 | ERR-SEVERE | S9(4) COMP | +12 | Severe error - processing stopped |
| 05 | ERR-TERMINAL | S9(4) COMP | +16 | Terminal error - immediate abort |

### Error Message Structure (ERR-MESSAGE)

Provides a comprehensive structure for capturing error details:

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 01 | ERR-MESSAGE | - | Error message group (362 bytes total) |
| 05 | ERR-TIMESTAMP | - | Timestamp group |
| 10 | ERR-DATE | X(10) | Error date (YYYY-MM-DD format) |
| 10 | ERR-TIME | X(8) | Error time (HH:MM:SS format) |
| 05 | ERR-PROGRAM | X(8) | Program name where error occurred |
| 05 | ERR-CATEGORY | X(2) | Error category code (VS, VL, PR, SY) |
| 05 | ERR-CODE | X(4) | Application-specific error code |
| 05 | ERR-SEVERITY | S9(4) COMP | Severity level (0, 4, 8, 12, 16) |
| 05 | ERR-TEXT | X(80) | Brief error description |
| 05 | ERR-DETAILS | X(256) | Extended error details and context |

### VSAM Status Handling (ERR-VSAM-STATUSES)

Pre-defined VSAM file status codes:

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 01 | ERR-VSAM-STATUSES | - | - | VSAM status codes group |
| 05 | ERR-VSAM-SUCCESS | X(2) | '00' | Successful operation |
| 05 | ERR-VSAM-DUPKEY | X(2) | '22' | Duplicate key on write |
| 05 | ERR-VSAM-NOTFND | X(2) | '23' | Record not found |
| 05 | ERR-VSAM-EOF | X(2) | '10' | End of file reached |

### VSAM Error Messages (ERR-VSAM-MSGS)

Pre-defined messages for common VSAM errors:

| Level | Name | Picture | Value | Description |
|-------|------|---------|-------|-------------|
| 01 | ERR-VSAM-MSGS | - | - | VSAM message group |
| 05 | ERR-VSAM-22 | X(80) | 'Duplicate record key' | Message for status 22 |
| 05 | ERR-VSAM-23 | X(80) | 'Record not found' | Message for status 23 |
| 05 | ERR-OTHER | X(80) | 'Unexpected VSAM error' | Default message for other errors |

## Usage Examples

### Basic Error Handling

```cobol
WORKING-STORAGE SECTION.
    COPY ERRHAND.

PROCEDURE DIVISION.
    ...
    IF WS-FILE-STATUS NOT = ERR-VSAM-SUCCESS
        MOVE 'MYPROG' TO ERR-PROGRAM
        MOVE ERR-CAT-VSAM TO ERR-CATEGORY
        MOVE WS-FILE-STATUS TO ERR-CODE
        MOVE ERR-ERROR TO ERR-SEVERITY
        MOVE ERR-VSAM-23 TO ERR-TEXT
        PERFORM 9000-ERROR-HANDLER
    END-IF
```

### Setting Return Codes

```cobol
* On successful completion
    MOVE ERR-SUCCESS TO RETURN-CODE
    GOBACK

* On warning condition
    MOVE ERR-WARNING TO RETURN-CODE
    GOBACK

* On error requiring investigation
    MOVE ERR-ERROR TO RETURN-CODE
    GOBACK

* On severe error requiring intervention
    MOVE ERR-SEVERE TO RETURN-CODE
    GOBACK
```

### VSAM Error Translation

```cobol
2100-HANDLE-VSAM-ERROR.
    MOVE 'MYPROGRAM' TO ERR-PROGRAM
    MOVE ERR-CAT-VSAM TO ERR-CATEGORY
    MOVE WS-FILE-STATUS TO ERR-CODE
    
    EVALUATE WS-FILE-STATUS
        WHEN ERR-VSAM-DUPKEY
            MOVE ERR-WARNING TO ERR-SEVERITY
            MOVE ERR-VSAM-22 TO ERR-TEXT
        WHEN ERR-VSAM-NOTFND
            MOVE ERR-WARNING TO ERR-SEVERITY
            MOVE ERR-VSAM-23 TO ERR-TEXT
        WHEN OTHER
            MOVE ERR-ERROR TO ERR-SEVERITY
            MOVE ERR-OTHER TO ERR-TEXT
    END-EVALUATE
    
    CALL 'ERRPROC' USING ERR-MESSAGE
    .
```

### Complete Error Message Population

```cobol
9000-BUILD-ERROR-MESSAGE.
    ACCEPT ERR-DATE FROM DATE YYYYMMDD
    ACCEPT ERR-TIME FROM TIME
    
    MOVE 'PORTMSTR' TO ERR-PROGRAM
    MOVE ERR-CAT-VALID TO ERR-CATEGORY
    MOVE 'V001' TO ERR-CODE
    MOVE ERR-ERROR TO ERR-SEVERITY
    MOVE 'Invalid portfolio ID format' TO ERR-TEXT
    STRING 'Portfolio ID: ' DELIMITED SIZE
           WS-PORTFOLIO-ID DELIMITED SPACE
           ' does not match required pattern PORT99999'
           DELIMITED SIZE
           INTO ERR-DETAILS
    END-STRING
    .
```

## Programs Using This Copybook

ERRHAND is used by 19 programs across the system:

### Batch Processing Programs

| Program | Description |
|---------|-------------|
| BCHCTL00 | Batch control processing |
| HISTLD00 | Position history DB2 loader |
| PRCSEQ00 | Process sequencing |
| RCVPRC00 | Recovery processing |

### Reporting Programs

| Program | Description |
|---------|-------------|
| RPTAUD00 | Audit report generation |
| RPTPOS00 | Position report generation |
| RPTSTA00 | Status report generation |

### DB2 Programs

| Program | Description |
|---------|-------------|
| DB2CMT | DB2 commit controller |
| DB2CONN | DB2 connection manager |
| DB2ERR | DB2 error handler |
| DB2STAT | DB2 status checker |

### Utility Programs

| Program | Description |
|---------|-------------|
| ERRPROC | Error processing routine |
| UTLMNT00 | Maintenance utility |
| UTLMON00 | Monitoring utility |
| UTLVAL00 | Validation utility |

### Portfolio Programs

| Program | Description |
|---------|-------------|
| PORTTEST | Portfolio testing |
| PORTTRAN | Portfolio transactions |

### Test Programs

| Program | Description |
|---------|-------------|
| TSTGEN00 | Test data generation |
| TSTVAL00 | Test validation |

## Related Copybooks

| Copybook | Relationship |
|----------|--------------|
| ERRHND | Online version of error handling (used by CICS programs) |
| RTNCODE | Return code management (complements ERRHAND) |
| RETHND | Alternate error handling for specific modules |

## Technical Notes

### Return Code Conventions

The return codes follow IBM mainframe conventions:

| Code | JCL Condition | Typical Action |
|------|---------------|----------------|
| 0 | COND=(0,EQ) | Continue to next step |
| 4 | COND=(4,LE) | Continue with warning logged |
| 8 | COND=(8,LE) | Skip dependent steps |
| 12 | COND=(12,LE) | Skip remaining steps, alert operations |
| 16 | COND=(16,LE) | Immediate job termination, page on-call |

### Error Category Usage Guidelines

| Category | When to Use |
|----------|-------------|
| VS (VSAM) | File open, read, write, close errors |
| VL (Validation) | Data format, range, or business rule violations |
| PR (Processing) | Logic errors, calculation failures, state errors |
| SY (System) | Resource unavailable, environment issues, abends |

### ERR-MESSAGE Storage Requirements

The ERR-MESSAGE structure requires 362 bytes of working storage:
- ERR-TIMESTAMP: 18 bytes
- ERR-PROGRAM: 8 bytes
- ERR-CATEGORY: 2 bytes
- ERR-CODE: 4 bytes
- ERR-SEVERITY: 2 bytes (COMP)
- ERR-TEXT: 80 bytes
- ERR-DETAILS: 256 bytes

### Integration with ERRPROC

The ERR-MESSAGE structure is designed to be passed directly to the ERRPROC program:

```cobol
CALL 'ERRPROC' USING ERR-MESSAGE
```

ERRPROC handles:
- Writing to error log files
- Sending alerts for severe errors
- Formatting messages for operator console
- Accumulating error statistics

### VSAM Status Code Reference

Common VSAM status codes not explicitly defined:

| Status | Meaning |
|--------|---------|
| 00 | Successful |
| 02 | Duplicate alternate key (non-unique) |
| 10 | End of file |
| 21 | Sequence error |
| 22 | Duplicate primary key |
| 23 | Record not found |
| 24 | Boundary violation |
| 35 | File not found |
| 39 | Attribute mismatch |
| 41 | File already open |
| 42 | File already closed |
| 46 | Read without position |
| 47 | Read on file not opened for input |
| 48 | Write on file not opened for output |
| 49 | Delete/rewrite without prior read |

### Best Practices

1. **Always populate ERR-PROGRAM**: Helps trace errors to source
2. **Use appropriate categories**: Enables filtering in error reports
3. **Include context in ERR-DETAILS**: Key values, record counts, etc.
4. **Match severity to impact**: Don't over-escalate warnings
5. **Timestamp all errors**: Essential for debugging timing issues
