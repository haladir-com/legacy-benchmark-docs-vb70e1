---
title: "PORTFLIO"
description: "Portfolio Master Record Layout - defines the standard data structure for portfolio records including client information, financial data, and audit trail"
---

## Overview

PORTFLIO is a copybook that defines the standard record layout for portfolio master records. It provides the data structure used throughout the portfolio management system for storing and managing investment portfolio information.

This copybook is fundamental to the portfolio management infrastructure, containing:
- **Portfolio Identification** - Unique keys for portfolio and account tracking
- **Client Information** - Owner details and account classification
- **Portfolio Details** - Status, creation date, and maintenance tracking
- **Financial Data** - Total value and cash balance in packed decimal format
- **Audit Trail** - Last user and transaction date for compliance

## Record Layout

```
+------------------------------------------------------------------+
|                        PORT-RECORD                                |
+------------------------------------------------------------------+
| PORT-KEY (18 bytes)                                               |
|   +-- PORT-ID (8) + PORT-ACCOUNT-NO (10)                         |
+------------------------------------------------------------------+
| PORT-CLIENT-INFO (31 bytes)                                       |
|   +-- PORT-CLIENT-NAME (30) + PORT-CLIENT-TYPE (1)               |
+------------------------------------------------------------------+
| PORT-PORTFOLIO-INFO (17 bytes)                                    |
|   +-- PORT-CREATE-DATE (8) + PORT-LAST-MAINT (8) + STATUS (1)    |
+------------------------------------------------------------------+
| PORT-FINANCIAL-INFO (16 bytes)                                    |
|   +-- PORT-TOTAL-VALUE (8) + PORT-CASH-BALANCE (8)               |
+------------------------------------------------------------------+
| PORT-AUDIT-INFO (16 bytes)                                        |
|   +-- PORT-LAST-USER (8) + PORT-LAST-TRANS (8)                   |
+------------------------------------------------------------------+
| PORT-FILLER (50 bytes)                                            |
+------------------------------------------------------------------+
| Total: ~148 bytes                                                 |
+------------------------------------------------------------------+
```

## Data Structures

### Portfolio Record (PORT-RECORD)

The top-level record structure:

| Level | Name | Description |
|-------|------|-------------|
| 01 | PORT-RECORD | Complete portfolio master record |

### Record Key (PORT-KEY)

The composite primary key for indexed file access:

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PORT-KEY | - | Composite primary key (18 bytes) |
| 10 | PORT-ID | X(8) | Unique portfolio identifier |
| 10 | PORT-ACCOUNT-NO | X(10) | Associated account number |

**Key Usage:**
- Used as RECORD KEY in indexed file SELECT statements
- Supports both random and sequential access patterns
- Combination ensures uniqueness across the portfolio system

### Client Information (PORT-CLIENT-INFO)

Owner and account classification data:

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PORT-CLIENT-INFO | - | Client information group |
| 10 | PORT-CLIENT-NAME | X(30) | Client/owner name |
| 10 | PORT-CLIENT-TYPE | X(1) | Account type classification |
| 88 | PORT-INDIVIDUAL | VALUE 'I' | Individual investor account |
| 88 | PORT-CORPORATE | VALUE 'C' | Corporate/institutional account |
| 88 | PORT-TRUST | VALUE 'T' | Trust or fiduciary account |

**Client Type Values:**

| Code | Condition Name | Description |
|------|----------------|-------------|
| I | PORT-INDIVIDUAL | Personal investment account for individuals |
| C | PORT-CORPORATE | Business or institutional investment account |
| T | PORT-TRUST | Trust, estate, or fiduciary account |

### Portfolio Information (PORT-PORTFOLIO-INFO)

Status and date tracking:

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PORT-PORTFOLIO-INFO | - | Portfolio details group |
| 10 | PORT-CREATE-DATE | 9(8) | Creation date (YYYYMMDD) |
| 10 | PORT-LAST-MAINT | 9(8) | Last maintenance date (YYYYMMDD) |
| 10 | PORT-STATUS | X(1) | Current portfolio status |
| 88 | PORT-ACTIVE | VALUE 'A' | Active and operational |
| 88 | PORT-CLOSED | VALUE 'C' | Closed/terminated |
| 88 | PORT-SUSPENDED | VALUE 'S' | Temporarily suspended |

**Status Values:**

| Code | Condition Name | Description |
|------|----------------|-------------|
| A | PORT-ACTIVE | Portfolio is active and can process transactions |
| C | PORT-CLOSED | Portfolio has been closed; no new transactions |
| S | PORT-SUSPENDED | Portfolio is temporarily frozen pending review |

### Financial Information (PORT-FINANCIAL-INFO)

Monetary values in packed decimal format:

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PORT-FINANCIAL-INFO | - | Financial data group |
| 10 | PORT-TOTAL-VALUE | S9(13)V99 COMP-3 | Total portfolio value |
| 10 | PORT-CASH-BALANCE | S9(13)V99 COMP-3 | Available cash balance |

**Technical Details:**
- **COMP-3 (Packed Decimal)**: Efficient storage for financial calculations
- **S9(13)V99**: Signed, 13 integer digits, 2 decimal places
- **Storage**: 8 bytes each (15 digits packed = 8 bytes)
- **Range**: -9,999,999,999,999.99 to +9,999,999,999,999.99

### Audit Information (PORT-AUDIT-INFO)

Change tracking for compliance:

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PORT-AUDIT-INFO | - | Audit trail group |
| 10 | PORT-LAST-USER | X(8) | User ID of last modifier |
| 10 | PORT-LAST-TRANS | 9(8) | Date of last transaction (YYYYMMDD) |

### Reserved Space (PORT-FILLER)

| Level | Name | Picture | Description |
|-------|------|---------|-------------|
| 05 | PORT-FILLER | X(50) | Reserved for future expansion |

## Usage

### File Definition (Indexed File)

```cobol
FILE-CONTROL.
    SELECT PORTFOLIO-FILE
        ASSIGN TO PORTFILE
        ORGANIZATION IS INDEXED
        ACCESS MODE IS DYNAMIC
        RECORD KEY IS PORT-KEY
        FILE STATUS IS WS-FILE-STATUS.

FILE SECTION.
FD  PORTFOLIO-FILE.
    COPY PORTFLIO.
```

### File Definition (Sequential File)

```cobol
FILE-CONTROL.
    SELECT PORTFOLIO-FILE
        ASSIGN TO PORTFILE
        ORGANIZATION IS SEQUENTIAL
        FILE STATUS IS WS-FILE-STATUS.

FILE SECTION.
FD  PORTFOLIO-FILE.
    COPY PORTFLIO.
```

### Working-Storage Usage

```cobol
WORKING-STORAGE SECTION.
01  WS-PORTFOLIO-RECORD.
    COPY PORTFLIO.
```

### Creating a New Portfolio

```cobol
INITIALIZE PORT-RECORD

MOVE 'PORT0001'    TO PORT-ID
MOVE '1234567890'  TO PORT-ACCOUNT-NO
MOVE 'SMITH, JOHN' TO PORT-CLIENT-NAME
SET PORT-INDIVIDUAL TO TRUE
ACCEPT PORT-CREATE-DATE FROM DATE YYYYMMDD
MOVE PORT-CREATE-DATE TO PORT-LAST-MAINT
SET PORT-ACTIVE TO TRUE
MOVE ZERO TO PORT-TOTAL-VALUE
MOVE ZERO TO PORT-CASH-BALANCE
MOVE 'ADMIN001' TO PORT-LAST-USER
MOVE PORT-CREATE-DATE TO PORT-LAST-TRANS

WRITE PORT-RECORD
```

### Reading by Key

```cobol
MOVE 'PORT0001'   TO PORT-ID
MOVE '1234567890' TO PORT-ACCOUNT-NO

READ PORTFOLIO-FILE
    INVALID KEY
        DISPLAY 'Portfolio not found'
    NOT INVALID KEY
        DISPLAY 'Client: ' PORT-CLIENT-NAME
        DISPLAY 'Value:  ' PORT-TOTAL-VALUE
END-READ
```

### Checking Status with 88-Levels

```cobol
READ PORTFOLIO-FILE

EVALUATE TRUE
    WHEN PORT-ACTIVE
        PERFORM PROCESS-TRANSACTION
    WHEN PORT-SUSPENDED
        DISPLAY 'Portfolio suspended - no transactions allowed'
    WHEN PORT-CLOSED
        DISPLAY 'Portfolio closed'
END-EVALUATE
```

### Updating Financial Values

```cobol
READ PORTFOLIO-FILE

ADD WS-TRANSACTION-AMOUNT TO PORT-TOTAL-VALUE
SUBTRACT WS-FEE-AMOUNT FROM PORT-CASH-BALANCE
ACCEPT PORT-LAST-MAINT FROM DATE YYYYMMDD
MOVE WS-USER-ID TO PORT-LAST-USER
MOVE PORT-LAST-MAINT TO PORT-LAST-TRANS

REWRITE PORT-RECORD
```

## Programs Using This Copybook

### PORTADD - Portfolio Addition Program

**Purpose:** Creates new portfolio records from an input file

**Usage:**
- Copies PORTFLIO for both PORTFOLIO-FILE (indexed, I-O) and INPUT-FILE (sequential)
- Validates PORT-ID, PORT-CLIENT-NAME, and PORT-STATUS before writing
- Sets PORT-CREATE-DATE and PORT-LAST-MAINT to current date
- Handles duplicate key errors (file status '22')

### PORTREAD - Portfolio Reading Program

**Purpose:** Sequentially reads and displays all portfolio records

**Usage:**
- Uses dynamic access mode for sequential reading
- Displays PORT-ID, PORT-ACCOUNT-NO, PORT-CLIENT-NAME, PORT-STATUS, PORT-TOTAL-VALUE
- Counts total records processed

### PORTUPDT - Portfolio Update Program

**Purpose:** Updates existing portfolio records based on update requests

**Usage:**
- Reads portfolio by PORT-KEY for random access
- Updates PORT-STATUS, PORT-CLIENT-NAME, or PORT-TOTAL-VALUE based on action code
- Uses REWRITE to update records in place

### PORTDEL - Portfolio Deletion Program

**Purpose:** Processes portfolio deletion requests with audit trail

**Usage:**
- Reads portfolio by PORT-KEY
- Deletes record using DELETE statement
- Writes audit record with PORT-KEY, PORT-STATUS, and deletion reason

### PORTTEST - Portfolio Test Data Generator

**Purpose:** Generates test portfolio records for development and testing

**Usage:**
- Creates PORT-RECORD with generated values
- Uses FUNCTION RANDOM for PORT-CLIENT-TYPE and PORT-STATUS selection
- Computes PORT-TOTAL-VALUE and PORT-CASH-BALANCE randomly
- Generates PORT-ID using STRING with sequence counter

### TSTGEN00 - Test Data Generator

**Purpose:** System-wide test data generation utility

**Usage:**
- Uses COPY PORTFLIO with REPLACING clause for prefix substitution
- Generates portfolio records as part of comprehensive test data sets
- Writes to sequential output file for batch loading

## File Status Codes

Common file status codes when using PORTFLIO:

| Status | Meaning | Typical Cause |
|--------|---------|---------------|
| 00 | Success | Operation completed normally |
| 10 | End of file | Sequential read past last record |
| 22 | Duplicate key | Attempting to write existing PORT-KEY |
| 23 | Record not found | PORT-KEY doesn't exist for READ/DELETE |
| 35 | File not found | PORTFILE DD not defined |

## VSAM Considerations

When used with VSAM KSDS (Key-Sequenced Data Set):

- **Primary Key**: PORT-KEY (18 bytes) - PORT-ID + PORT-ACCOUNT-NO
- **Record Length**: Fixed, approximately 148 bytes
- **CI Size**: Recommend 4096 for typical volumes
- **SHAREOPTIONS**: (2,3) for batch/online sharing

**Sample VSAM Definition:**
```jcl
DEFINE CLUSTER (NAME(your.portfolio.file) -
                INDEXED -
                KEYS(18 0) -
                RECORDSIZE(148 148) -
                CISZ(4096) -
                SHAREOPTIONS(2,3))
```

## Best Practices

1. **Always Initialize**: Use `INITIALIZE PORT-RECORD` before creating new records to clear PORT-FILLER and ensure clean data

2. **Validate Status**: Check PORT-STATUS using 88-level conditions before processing transactions

3. **Maintain Audit Trail**: Always update PORT-LAST-USER and PORT-LAST-TRANS when modifying records

4. **Handle Duplicates**: Check for file status '22' when writing to prevent silent failures

5. **Date Consistency**: Use `ACCEPT FROM DATE YYYYMMDD` for consistent date formatting

6. **Financial Precision**: PORT-TOTAL-VALUE and PORT-CASH-BALANCE use COMP-3 for accurate decimal arithmetic; avoid intermediate display fields

## Related Copybooks

| Copybook | Relationship |
|----------|--------------|
| POSREC | Position records linked to portfolios by portfolio ID |
| TRNREC | Transaction records associated with portfolio activity |
| HISTREC | Historical records for portfolio performance tracking |
