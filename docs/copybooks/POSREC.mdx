---
title: "POSREC"
description: "Position record structure copybook defining the layout for investment position data including holdings, valuations, and audit information"
---

## Overview

POSREC is a core data structure copybook that defines the standard layout for investment position records in the portfolio management system. A position represents a holding of a specific investment within a portfolio on a given date, tracking quantities, cost basis, and current market values.

This copybook is fundamental to the portfolio management domain, used by programs that:
- Generate position reports (RPTPOS00)
- Process portfolio inquiries (INQPORT)
- Validate position data (UTLVAL00)

The record structure supports:
- **Multi-key access**: Composite key of portfolio, date, and investment
- **Financial tracking**: Quantity, cost basis, and market value with high precision
- **Status management**: Active, closed, and pending position states
- **Audit trail**: Last maintenance timestamp and user tracking

## Data Structures

### Complete Record Layout (POSITION-RECORD)

| Level | Name | Picture | Bytes | Description |
|-------|------|---------|-------|-------------|
| 01 | POSITION-RECORD | - | ~145 | Complete position record |

### Key Section (POS-KEY)

The composite key uniquely identifies a position:

| Level | Name | Picture | Bytes | Description |
|-------|------|---------|-------|-------------|
| 05 | POS-KEY | - | 26 | Composite primary key |
| 10 | POS-PORTFOLIO-ID | X(08) | 8 | Portfolio identifier |
| 10 | POS-DATE | X(08) | 8 | Position date (YYYYMMDD) |
| 10 | POS-INVESTMENT-ID | X(10) | 10 | Investment/security identifier |

### Data Section (POS-DATA)

Financial and status information:

| Level | Name | Picture | Bytes | Description |
|-------|------|---------|-------|-------------|
| 05 | POS-DATA | - | 27 | Position data group |
| 10 | POS-QUANTITY | S9(11)V9(4) COMP-3 | 8 | Holding quantity (4 decimal places) |
| 10 | POS-COST-BASIS | S9(13)V9(2) COMP-3 | 8 | Total cost basis (2 decimal places) |
| 10 | POS-MARKET-VALUE | S9(13)V9(2) COMP-3 | 8 | Current market value (2 decimal places) |
| 10 | POS-CURRENCY | X(03) | 3 | Currency code (ISO 4217) |
| 10 | POS-STATUS | X(01) | 1 | Position status code |

### Status Codes (88-Level Conditions)

| Condition Name | Value | Description |
|----------------|-------|-------------|
| POS-STATUS-ACTIVE | 'A' | Position is active and held |
| POS-STATUS-CLOSED | 'C' | Position has been fully liquidated |
| POS-STATUS-PEND | 'P' | Position change is pending settlement |

### Audit Section (POS-AUDIT)

Tracks last modification:

| Level | Name | Picture | Bytes | Description |
|-------|------|---------|-------|-------------|
| 05 | POS-AUDIT | - | 34 | Audit information group |
| 10 | POS-LAST-MAINT-DATE | X(26) | 26 | Last maintenance timestamp |
| 10 | POS-LAST-MAINT-USER | X(08) | 8 | User who last modified |

### Filler

| Level | Name | Picture | Bytes | Description |
|-------|------|---------|-------|-------------|
| 05 | POS-FILLER | X(50) | 50 | Reserved for future use |

## Field Specifications

### POS-PORTFOLIO-ID

- **Format**: 8 alphanumeric characters
- **Pattern**: Typically 'PORTnnnn' format
- **Example**: `PORT0001`, `PORT1234`
- **Validation**: Must reference valid portfolio in portfolio master

### POS-DATE

- **Format**: YYYYMMDD (8 characters)
- **Example**: `20240315` for March 15, 2024
- **Usage**: Represents the as-of date for the position
- **Note**: Multiple positions can exist for same portfolio/investment on different dates

### POS-INVESTMENT-ID

- **Format**: 10 alphanumeric characters
- **Examples**: `AAPL`, `MSFT123456`, `BND0000001`
- **Usage**: Links to security/investment master data

### POS-QUANTITY

- **Format**: Signed packed decimal, 11 integers + 4 decimals
- **Range**: -99,999,999,999.9999 to +99,999,999,999.9999
- **Storage**: 8 bytes (COMP-3)
- **Usage**: Number of shares, units, or contracts held
- **Note**: Supports fractional shares for mutual funds

### POS-COST-BASIS

- **Format**: Signed packed decimal, 13 integers + 2 decimals
- **Range**: -9,999,999,999,999.99 to +9,999,999,999,999.99
- **Storage**: 8 bytes (COMP-3)
- **Usage**: Total acquisition cost of the position
- **Calculation**: Sum of (quantity × purchase price) for all lots

### POS-MARKET-VALUE

- **Format**: Signed packed decimal, 13 integers + 2 decimals
- **Range**: -9,999,999,999,999.99 to +9,999,999,999,999.99
- **Storage**: 8 bytes (COMP-3)
- **Usage**: Current market value (quantity × current price)
- **Note**: Updated by market data feeds or end-of-day pricing

### POS-CURRENCY

- **Format**: 3-character ISO 4217 currency code
- **Examples**: `USD`, `EUR`, `GBP`, `JPY`
- **Usage**: Currency for cost basis and market value amounts

### POS-LAST-MAINT-DATE

- **Format**: ISO 8601 timestamp (26 characters)
- **Pattern**: YYYY-MM-DD-HH.MM.SS.NNNNNN
- **Example**: `2024-03-15-14.30.45.123456`
- **Usage**: Audit trail for last modification

## Usage Examples

### Reading Position Records

```cobol
FILE SECTION.
    COPY POSREC.

WORKING-STORAGE SECTION.
01  WS-FILE-STATUS    PIC XX.

PROCEDURE DIVISION.
    OPEN INPUT POSITION-FILE
    
    MOVE 'PORT0001' TO POS-PORTFOLIO-ID
    MOVE '20240315' TO POS-DATE
    MOVE 'AAPL      ' TO POS-INVESTMENT-ID
    
    READ POSITION-FILE
        INVALID KEY
            DISPLAY 'Position not found'
        NOT INVALID KEY
            DISPLAY 'Quantity: ' POS-QUANTITY
            DISPLAY 'Market Value: ' POS-MARKET-VALUE
    END-READ
    .
```

### Processing Active Positions

```cobol
2000-PROCESS-POSITIONS.
    PERFORM UNTIL END-OF-FILE
        READ POSITION-FILE NEXT
            AT END
                SET END-OF-FILE TO TRUE
            NOT AT END
                IF POS-STATUS-ACTIVE
                    PERFORM 2100-CALCULATE-GAIN-LOSS
                END-IF
        END-READ
    END-PERFORM
    .

2100-CALCULATE-GAIN-LOSS.
    COMPUTE WS-GAIN-LOSS = 
        POS-MARKET-VALUE - POS-COST-BASIS
    
    IF WS-GAIN-LOSS > 0
        ADD WS-GAIN-LOSS TO WS-TOTAL-GAINS
    ELSE
        ADD WS-GAIN-LOSS TO WS-TOTAL-LOSSES
    END-IF
    .
```

### Updating Position Status

```cobol
3000-CLOSE-POSITION.
    MOVE 'C' TO POS-STATUS
    
    ACCEPT WS-TIMESTAMP FROM TIME
    MOVE WS-TIMESTAMP TO POS-LAST-MAINT-DATE
    MOVE WS-USER-ID TO POS-LAST-MAINT-USER
    
    REWRITE POSITION-RECORD
        INVALID KEY
            PERFORM 9000-HANDLE-ERROR
    END-REWRITE
    .
```

### Creating a New Position

```cobol
4000-CREATE-POSITION.
    INITIALIZE POSITION-RECORD
    
    MOVE WS-PORTFOLIO    TO POS-PORTFOLIO-ID
    MOVE WS-TRADE-DATE   TO POS-DATE
    MOVE WS-SECURITY     TO POS-INVESTMENT-ID
    
    MOVE WS-SHARES       TO POS-QUANTITY
    COMPUTE POS-COST-BASIS = WS-SHARES * WS-PRICE
    COMPUTE POS-MARKET-VALUE = WS-SHARES * WS-CURRENT-PRICE
    
    MOVE 'USD'           TO POS-CURRENCY
    MOVE 'A'             TO POS-STATUS
    
    ACCEPT POS-LAST-MAINT-DATE FROM TIME
    MOVE WS-USER-ID      TO POS-LAST-MAINT-USER
    
    WRITE POSITION-RECORD
        INVALID KEY
            PERFORM 9000-HANDLE-DUPLICATE
    END-WRITE
    .
```

### Reporting with Formatted Output

```cobol
5000-FORMAT-POSITION-LINE.
    MOVE POS-PORTFOLIO-ID  TO RPT-PORTFOLIO
    MOVE POS-INVESTMENT-ID TO RPT-INVESTMENT
    MOVE POS-QUANTITY      TO RPT-QTY-EDITED
    MOVE POS-MARKET-VALUE  TO RPT-VALUE-EDITED
    
    COMPUTE WS-UNREALIZED-GL = 
        POS-MARKET-VALUE - POS-COST-BASIS
    MOVE WS-UNREALIZED-GL  TO RPT-GL-EDITED
    
    IF POS-STATUS-ACTIVE
        MOVE 'ACTIVE ' TO RPT-STATUS
    ELSE IF POS-STATUS-CLOSED
        MOVE 'CLOSED ' TO RPT-STATUS
    ELSE
        MOVE 'PENDING' TO RPT-STATUS
    END-IF
    
    WRITE REPORT-LINE FROM RPT-DETAIL-LINE
    .
```

## Programs Using This Copybook

POSREC is used by 3 programs:

| Program | Description | Usage |
|---------|-------------|-------|
| RPTPOS00 | Daily position report generator | Reads positions for reporting |
| INQPORT | Portfolio inquiry (online) | Displays position details |
| UTLVAL00 | Data validation utility | Validates position data integrity |

## Related Copybooks

| Copybook | Relationship |
|----------|--------------|
| TRNREC | Transaction record - transactions affect positions |
| PORTFLIO | Portfolio master - parent record for positions |
| HISTREC | History record - historical position snapshots |

## Technical Notes

### COMP-3 (Packed Decimal) Storage

The numeric fields use COMP-3 format for efficient storage:

| Field | Picture | Digits | Storage |
|-------|---------|--------|---------|
| POS-QUANTITY | S9(11)V9(4) | 15 + sign | 8 bytes |
| POS-COST-BASIS | S9(13)V9(2) | 15 + sign | 8 bytes |
| POS-MARKET-VALUE | S9(13)V9(2) | 15 + sign | 8 bytes |

**Calculation**: (digits + 1) / 2, rounded up

### Record Size Calculation

| Section | Bytes |
|---------|-------|
| POS-KEY | 26 |
| POS-DATA | 27 |
| POS-AUDIT | 34 |
| POS-FILLER | 50 |
| **Total** | **137** |

### Key Design Considerations

The composite key (Portfolio + Date + Investment) enables:
1. **Point-in-time queries**: Get position as of specific date
2. **Portfolio views**: All positions for a portfolio
3. **Investment analysis**: All portfolios holding a security
4. **Historical tracking**: Position changes over time

### File Organization

Typically stored in VSAM KSDS with:
- **Primary key**: POS-KEY (26 bytes)
- **Alternate index**: By POS-INVESTMENT-ID (for security-based queries)
- **Alternate index**: By POS-DATE + POS-PORTFOLIO-ID (for date-based processing)

### Currency Considerations

- All monetary values should be in the currency specified by POS-CURRENCY
- Cross-currency calculations require conversion using current exchange rates
- Multi-currency portfolios may have positions in different currencies

### Precision Requirements

| Field | Precision | Rationale |
|-------|-----------|-----------|
| Quantity | 4 decimals | Supports fractional shares (mutual funds) |
| Cost Basis | 2 decimals | Standard currency precision |
| Market Value | 2 decimals | Standard currency precision |

### Gain/Loss Calculation

```
Unrealized Gain/Loss = POS-MARKET-VALUE - POS-COST-BASIS
Gain/Loss Percentage = (Unrealized G/L / POS-COST-BASIS) × 100
```

### Status Transition Rules

| From | To | Trigger |
|------|-----|---------|
| (new) | Active | Initial purchase |
| (new) | Pending | Purchase awaiting settlement |
| Pending | Active | Settlement complete |
| Active | Pending | Sale awaiting settlement |
| Active | Closed | Full liquidation |
| Pending | Closed | Pending sale settles |
