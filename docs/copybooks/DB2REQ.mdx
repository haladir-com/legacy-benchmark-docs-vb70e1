---
title: "DB2REQ"
description: "DB2 Request Area copybook for online CICS programs"
---

# DB2REQ Copybook

## Overview

**DB2REQ** (DB2 Request Area) is an online copybook that defines the communication interface for DB2 connection management in CICS programs. It provides a standardized structure for requesting connections, disconnections, and status checks through programs like [DB2ONLN](/docs/programs/DB2ONLN).

## Data Structure

```
DB2-REQUEST-AREA (109 bytes total)
├── DB2-REQUEST-TYPE     (1 byte)   - Operation code
├── DB2-RESPONSE-CODE    (4 bytes)  - Response status
├── DB2-CONNECTION-TOKEN (16 bytes) - Connection identifier
└── DB2-ERROR-INFO       (88 bytes) - Error details
    ├── DB2-SQLCODE      (4 bytes)  - SQL error code
    └── DB2-ERROR-MSG    (80 bytes) - Error message text
```

### Field Definitions

| Field | Picture | Description |
|-------|---------|-------------|
| DB2-REQUEST-TYPE | X | Operation type code |
| DB2-RESPONSE-CODE | S9(8) COMP | Return status from service |
| DB2-CONNECTION-TOKEN | X(16) | Unique connection identifier |
| DB2-SQLCODE | S9(9) COMP | DB2 SQLCODE if error occurred |
| DB2-ERROR-MSG | X(80) | Descriptive error message |

### Request Type Codes (88-Level Conditions)

| Condition | Value | Description |
|-----------|-------|-------------|
| DB2-CONNECT | `'C'` | Request a DB2 connection |
| DB2-DISCONNECT | `'D'` | Release a DB2 connection |
| DB2-STATUS | `'S'` | Check connection status |

## Usage Example

```cobol
       WORKING-STORAGE SECTION.
           COPY DB2REQ.
       
       PROCEDURE DIVISION.
      *    Request a DB2 connection
           SET DB2-CONNECT TO TRUE
           INITIALIZE DB2-CONNECTION-TOKEN
           
           EXEC CICS LINK
               PROGRAM('DB2ONLN')
               COMMAREA(DB2-REQUEST-AREA)
               LENGTH(LENGTH OF DB2-REQUEST-AREA)
           END-EXEC
           
           IF DB2-RESPONSE-CODE = 0
               DISPLAY 'Connected with token: ' 
                       DB2-CONNECTION-TOKEN
           ELSE
               DISPLAY 'Connection failed: '
                       DB2-ERROR-MSG
               DISPLAY 'SQLCODE: ' DB2-SQLCODE
           END-IF.
           
      *    Later, disconnect
           SET DB2-DISCONNECT TO TRUE
           
           EXEC CICS LINK
               PROGRAM('DB2ONLN')
               COMMAREA(DB2-REQUEST-AREA)
               LENGTH(LENGTH OF DB2-REQUEST-AREA)
           END-EXEC.
```

## Response Codes

| Code | Meaning |
|------|---------|
| 0 | Success |
| -1 | Connection pool exhausted |
| Other | SQLCODE from failed operation |

## Programs Using This Copybook

| Program | Description |
|---------|-------------|
| [DB2RECV](/docs/programs/DB2RECV) | DB2 Recovery Manager |

## Related Copybooks

- [ERRHND](/docs/copybooks/ERRHND) - Online error handling
- [SQLCA](/docs/copybooks/SQLCA) - SQL Communication Area

## Technical Notes

1. **COMP Fields**: Both RESPONSE-CODE and SQLCODE use COMP (binary) for efficient numeric storage
2. **Token Usage**: The 16-byte connection token should be stored and passed on subsequent operations
3. **CICS Integration**: Designed for use with EXEC CICS LINK to the DB2ONLN service program
4. **Error Recovery**: On connection failure, check DB2-SQLCODE for the specific DB2 error
